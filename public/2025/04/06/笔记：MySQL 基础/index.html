

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>




<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/ba.jpg">
  <link rel="icon" href="/img/ba.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#373737">
  <meta name="author" content="霸天">
  <meta name="keywords" content="">
  
    <meta name="description" content="一、理论1. 导图：Map：MySQL  2. 数据库核心数据库管理系统、数据库、表  3. MySQL 最佳实践 4. MySQL 语法4.1. 语法要求 SQL 语句可以单行或多行，但要以分号（;）结尾 MySQL 默认情况下，每条 SQL 语句的最大长度为 4MB   4.2. 注释写法1234567# 单行注释-- 单行注释&#x2F;*多行注释*&#x2F;   4.3. DDL（库、表、列）4.3.1.">
<meta property="og:type" content="article">
<meta property="og:title" content="笔记：MySQL 基础">
<meta property="og:url" content="https://wangjia5289.github.io/2025/04/06/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="夜阑卧听风吹雨,一枝梨花压心头">
<meta property="og:description" content="一、理论1. 导图：Map：MySQL  2. 数据库核心数据库管理系统、数据库、表  3. MySQL 最佳实践 4. MySQL 语法4.1. 语法要求 SQL 语句可以单行或多行，但要以分号（;）结尾 MySQL 默认情况下，每条 SQL 语句的最大长度为 4MB   4.2. 注释写法1234567# 单行注释-- 单行注释&#x2F;*多行注释*&#x2F;   4.3. DDL（库、表、列）4.3.1.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://wangjia5289.github.io/2025/04/06/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250615085438498.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410141156407.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410141156407.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145608083.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145637852.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145648701.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145658659.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145805811.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145817283.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145951287.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410150044456.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410150052131.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410150102998.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410161532467.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410161552865.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410165218847.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410162851472.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410165304264.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410165415783.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410165544009.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521211043750.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521211108505.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521212132677.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521212154361.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250522101521175.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250522101539693.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250522101559348.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521211043750.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521211108505.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521212132677.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521212154361.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250409183911323.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250409192001892.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250409223121020.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410100653127.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250519144517641.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250523113818549.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMyCat2/image-20250406155610051.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410104022257.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410104203864.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250406182807697.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250408141545381.png">
<meta property="og:image" content="https://wangjia5289.github.io/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250408141924184.png">
<meta property="article:published_time" content="2025-04-05T16:00:00.000Z">
<meta property="article:modified_time" content="2025-07-13T15:19:19.590Z">
<meta property="article:author" content="Ba Tian">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://wangjia5289.github.io/2025/04/06/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250615085438498.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>笔记：MySQL 基础 - 夜阑卧听风吹雨,一枝梨花压心头</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"wangjia5289.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 100vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E5%85%89%E5%BD%B1%E7%BE%8E%E5%AD%A6-%E5%90%8A%E5%B8%A6%E8%A3%99.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="笔记：MySQL 基础"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-04-06 00:00" pubdate>
          April 6, 2025 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          22k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          183 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">笔记：MySQL 基础</h1>
            
              <p id="updated-time" class="note note-info" style="display: none">
                
                  
                    Last updated on 2025-07-13T23:19:19+08:00
                  
                  

                
              </p>
            
            
              <div class="markdown-body">
                
                <h1 id="一、理论"><a href="#一、理论" class="headerlink" title="一、理论"></a>一、理论</h1><h3 id="1-导图：Map：MySQL"><a href="#1-导图：Map：MySQL" class="headerlink" title="1. 导图：Map：MySQL"></a>1. 导图：<a href="Map%EF%BC%9AMySQL.xmind">Map：MySQL</a></h3><hr>
<p><img src="/2025/04/06/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250615085438498.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-数据库核心"><a href="#2-数据库核心" class="headerlink" title="2. 数据库核心"></a>2. 数据库核心</h3><p>数据库管理系统、数据库、表</p>
<hr>
<h3 id="3-MySQL-最佳实践"><a href="#3-MySQL-最佳实践" class="headerlink" title="3. MySQL 最佳实践"></a>3. MySQL 最佳实践</h3><hr>
<h3 id="4-MySQL-语法"><a href="#4-MySQL-语法" class="headerlink" title="4. MySQL 语法"></a>4. MySQL 语法</h3><h4 id="4-1-语法要求"><a href="#4-1-语法要求" class="headerlink" title="4.1. 语法要求"></a>4.1. 语法要求</h4><ol>
<li>SQL 语句可以单行或多行，但要以分号（<code>;</code>）结尾</li>
<li>MySQL 默认情况下，每条 SQL 语句的最大长度为 4MB</li>
</ol>
<hr>
<h4 id="4-2-注释写法"><a href="#4-2-注释写法" class="headerlink" title="4.2. 注释写法"></a>4.2. 注释写法</h4><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-comment"># 单行注释</span><br><br><span class="hljs-comment">-- 单行注释</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">多行注释</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure>

<hr>
<h4 id="4-3-DDL（库、表、列）"><a href="#4-3-DDL（库、表、列）" class="headerlink" title="4.3. DDL（库、表、列）"></a>4.3. DDL（库、表、列）</h4><h5 id="4-3-1-库-操作"><a href="#4-3-1-库-操作" class="headerlink" title="4.3.1. 库 操作"></a>4.3.1. 库 操作</h5><p>&#x3D;&#x3D;1.创建数据库&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> [<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span>] &lt;repository-<span class="hljs-type">name</span>&gt; [<span class="hljs-keyword">default</span> charset 字符集] [<span class="hljs-keyword">collate</span> 排序规则];<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>若不指定字符集，默认使用 utf8mb4；</li>
<li>若不指定排序规则，默认使用 utf8mb4_0900_ai_ci</li>
</ol>
</blockquote>
<p>&#x3D;&#x3D;2.删除数据库&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">database</span> [<span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span>] &lt;repository-<span class="hljs-type">name</span>&gt;;<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;3.更新数据库&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> 修改数据库名<br># <span class="hljs-number">1.1</span>. 导出旧数据库（将旧数据库导出到一个 <span class="hljs-keyword">SQL</span> 文件中)<br>mysqldump -p &lt;<span class="hljs-built_in">old</span>-repository-<span class="hljs-type">name</span>&gt; &gt; &lt;<span class="hljs-built_in">old</span>-repository-<span class="hljs-type">name</span>&gt; .<span class="hljs-keyword">sql</span><br>	<br># <span class="hljs-number">1.2</span>. 创建新的数据库<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> &lt;<span class="hljs-built_in">new</span>-repository-<span class="hljs-type">name</span>&gt;;<br>	<br># <span class="hljs-number">1.3</span>. 将旧库文件导入新库<br>mysql -p &lt;<span class="hljs-built_in">new</span>-repository-<span class="hljs-type">name</span>&gt; &lt; &lt;<span class="hljs-built_in">new</span>-repository-<span class="hljs-type">name</span>&gt;.<span class="hljs-keyword">sql</span><br><br># <span class="hljs-number">1.4</span>. 删除旧数据库<br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">DATABASE</span> &lt;<span class="hljs-built_in">old</span>-repository-<span class="hljs-type">name</span>&gt;;<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;4.查询数据库&#x3D;&#x3D;</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-meta"># 1. 查看所有数据库</span><br>show databases;<br><br><br><span class="hljs-meta"># 2. 查看当前使用的数据库</span><br><span class="hljs-function"><span class="hljs-keyword">select</span> <span class="hljs-title">databses</span>()</span>;<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;5.使用数据库&#x3D;&#x3D;</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-keyword">use</span> &lt;repository-<span class="hljs-keyword">name</span>&gt;;<br></code></pre></td></tr></table></figure>

<hr>
<h5 id="4-3-2-表-操作"><a href="#4-3-2-表-操作" class="headerlink" title="4.3.2. 表 操作"></a>4.3.2. 表 操作</h5><p>&#x3D;&#x3D;1.创建表&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> [<span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>] &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; (<br>    &lt;id-<span class="hljs-keyword">column</span>&gt; &lt;数据类型&gt; AUTO_INCREMENT <span class="hljs-keyword">PRIMARY KEY</span> [<span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;explanation for this column&#x27;</span>],<br>    &lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt; &lt;数据类型&gt; <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> [<span class="hljs-keyword">DEFAULT</span> &lt;默认值&gt;] [<span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;explanation for this column&#x27;</span>],<br>    &lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt; &lt;数据类型&gt; <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> [<span class="hljs-keyword">DEFAULT</span> &lt;默认值&gt;] [<span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;explanation for this column&#x27;</span>]<br>) [ENGINE=&lt;engine-<span class="hljs-keyword">type</span>&gt;] [<span class="hljs-keyword">DEFAULT</span> CHARSET=&lt;字符集&gt;] [<span class="hljs-keyword">COMMENT</span>=<span class="hljs-string">&#x27;explanation for this table&#x27;</span>];<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;2.删除表&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> [<span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span>] &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt;;<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;3.更新表&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> 修改表名<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-built_in">old</span>-<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">rename</span> <span class="hljs-keyword">to</span> &lt;<span class="hljs-built_in">new</span>-<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt;; <br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;4.查询表&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> 查看当前使用的数据库所有表<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">tables</span>;<br><br><br># <span class="hljs-number">2.</span> 查看表结构<br><span class="hljs-keyword">desc</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt;<br><br><br># <span class="hljs-number">3.</span> 查看建表语句<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt;;<br></code></pre></td></tr></table></figure>

<hr>
<h5 id="4-3-3-列-操作"><a href="#4-3-3-列-操作" class="headerlink" title="4.3.3. 列 操作"></a>4.3.3. 列 操作</h5><p>&#x3D;&#x3D;1.创建列&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">add</span> &lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt; &lt;数据类型&gt; [<span class="hljs-keyword">comment</span> <span class="hljs-string">&#x27;列的注释&#x27;</span>]<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;2.删除列&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">drop</span> <span class="hljs-keyword">column</span> &lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt;<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;3.修改列&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> 修改列名<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">rename</span> <span class="hljs-keyword">column</span> &lt;<span class="hljs-built_in">old</span>-<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">to</span> &lt;<span class="hljs-built_in">new</span>-<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt;<br></code></pre></td></tr></table></figure>

<hr>
<h4 id="4-4-DML（数据增删改）"><a href="#4-4-DML（数据增删改）" class="headerlink" title="4.4. DML（数据增删改）"></a>4.4. DML（数据增删改）</h4><h5 id="4-4-1-插入数据"><a href="#4-4-1-插入数据" class="headerlink" title="4.4.1. 插入数据"></a>4.4.1. 插入数据</h5><h6 id="4-4-1-1-数据插入原则"><a href="#4-4-1-1-数据插入原则" class="headerlink" title="4.4.1.1. 数据插入原则"></a>4.4.1.1. 数据插入原则</h6><ol>
<li>&#x3D;&#x3D;主键顺序插入&#x3D;&#x3D;：<ol>
<li>插入数据时，最好安装主键的递增顺序进行插入，因为顺序插入的性能通常高于乱序插入。这可以减少索引的重组和提高插入的效率</li>
</ol>
</li>
<li>&#x3D;&#x3D;开启事务&#x3D;&#x3D;：<ol>
<li>大量数据插入时，建议使用事务以确保数据的一致性和完整性。这样可以避免由于中途失败而导致的数据不一致问题，确保操作的原子性。</li>
</ol>
</li>
<li>&#x3D;&#x3D;以行为计&#x3D;&#x3D;：<ol>
<li>插入数据都是以行为单位，即插入一行或者多行，不能插入某一行的某一条数据</li>
</ol>
</li>
</ol>
<hr>
<h6 id="4-4-1-2-普通插入数据"><a href="#4-4-1-2-普通插入数据" class="headerlink" title="4.4.1.2. 普通插入数据"></a>4.4.1.2. 普通插入数据</h6><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"># 1. 模版<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> &lt;table-name&gt; [&lt;column1,column2,...&gt;] <span class="hljs-keyword">values</span> &lt;value1,value2,......&gt;<br><br><br># <span class="hljs-number">2.</span> 指定字段添加数据<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> students (name, age) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;Alice&#x27;</span>, <span class="hljs-number">20</span>);<br><br><br># 3. 全部字段添加数据<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> students <span class="hljs-keyword">values</span> (<span class="hljs-literal">NULL</span>, <span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-number">22</span>);<br><br><br># 4. 批量添加数据<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> students <span class="hljs-keyword">values</span> <br>(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&#x27;Alice&#x27;</span>, <span class="hljs-number">20</span>),<br>(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-number">22</span>),<br>(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&#x27;Charlie&#x27;</span>, <span class="hljs-number">21</span>),<br>(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&#x27;David&#x27;</span>, <span class="hljs-number">23</span>),<br>(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&#x27;Eva&#x27;</span>, <span class="hljs-number">19</span>);<br><br><br># 5. 主键回显<br># 5.1. 执行 inset 语句<br><span class="hljs-keyword">INSERT</span> xxxxxxx<br><br># <span class="hljs-number">5.2</span>. 获取上一条插入记录在表中的主键值<br><span class="hljs-keyword">SELECT</span> LAST_INSERT_ID();<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项：主键回显</p>
<ol>
<li>执行插入语句后，可以通过执行 <code>SELECT LAST_INSERT_ID()</code> 获取上一条插入记录的主键值。这样做的主要原因是，插入记录后，我们通常需要立即对该记录进行后续操作。如果再次使用 <code>SELECT</code> 查询来获取其 ID，这会增加额外的操作开销。通过主键回显，我们可以直接获得该记录的 ID，提高效率。</li>
</ol>
</blockquote>
<hr>
<h6 id="4-4-1-3-千万级插入数据"><a href="#4-4-1-3-千万级插入数据" class="headerlink" title="4.4.1.3. 千万级插入数据"></a>4.4.1.3. 千万级插入数据</h6><hr>
<h5 id="4-4-2-删除数据"><a href="#4-4-2-删除数据" class="headerlink" title="4.4.2. 删除数据"></a>4.4.2. 删除数据</h5><p>删除数据同样是以行为单位，即删除一行或者多行，不能删除某一行的某一条数据</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> 删除部分数据<br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; [<span class="hljs-keyword">where</span> condition];<br><br><br># <span class="hljs-number">2.</span> 删除整个表的数据（高效）<br><span class="hljs-keyword">truncate</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt;;<br><br><br># <span class="hljs-number">3.</span> 删除分区来删除数据（高效）<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">drop</span> <span class="hljs-keyword">partition</span> &lt;<span class="hljs-keyword">partition</span>-<span class="hljs-type">name</span>&gt;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项：</p>
<ol>
<li>如果使用 <code>delete from</code> 不加条件，它会删除整个表的数据，但这种方法效率较低，不推荐使用。如果必须采用此方法，建议分批删除（例如：<code>delete from table where id between 1 and 2000</code>），并<strong>开启事务</strong>以确保数据一致性和可靠性。</li>
<li>方法二和方法三不需要开启事务，因为他们都很高效</li>
</ol>
</blockquote>
<hr>
<h5 id="4-4-3-更新数据"><a href="#4-4-3-更新数据" class="headerlink" title="4.4.3. 更新数据"></a>4.4.3. 更新数据</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">table</span><span class="hljs-operator">-</span>name<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-operator">&lt;</span>column1<span class="hljs-operator">=</span>value1<span class="hljs-operator">&gt;</span>,<span class="hljs-operator">&lt;</span>column2<span class="hljs-operator">=</span>value2<span class="hljs-operator">&gt;</span>,.... [<span class="hljs-keyword">where</span> <span class="hljs-keyword">condition</span>];<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>如果需要批量更新数据，同样应该<strong>开启事务</strong></li>
</ol>
</blockquote>
<hr>
<h4 id="4-5-DQL（数据查询）"><a href="#4-5-DQL（数据查询）" class="headerlink" title="4.5. DQL（数据查询）"></a>4.5. DQL（数据查询）</h4><h5 id="4-5-1-数据查询模版"><a href="#4-5-1-数据查询模版" class="headerlink" title="4.5.1. 数据查询模版"></a>4.5.1. 数据查询模版</h5><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> [<span class="hljs-keyword">all</span> | <span class="hljs-keyword">distinct</span>] <br>&#123; * | &lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt; [<span class="hljs-keyword">as</span> 列别名] | &lt;表达式 [<span class="hljs-keyword">as</span> 表达式别名]&gt; &#125;       # 选择列表，表达式支持聚合函数<br><span class="hljs-keyword">from</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; [<span class="hljs-keyword">as</span> 表别名]                                    # 普通查询<br>[&lt;<span class="hljs-keyword">join</span>-<span class="hljs-keyword">type</span>&gt; <span class="hljs-keyword">join</span> &lt;other-<span class="hljs-keyword">table</span>&gt; [<span class="hljs-keyword">as</span> 表别名] <span class="hljs-keyword">on</span> &lt;连接条件&gt;]        # 多表联查<br>[<span class="hljs-keyword">where</span> &lt;行级过滤条件&gt;]                                            # 过滤条件不可使用聚合函数<br>[<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> &lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt; [<span class="hljs-keyword">having</span> &lt;组级过滤条件&gt;]]                  # 分组查询，过滤条件可使用聚合函数<br>[<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> &lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt; [<span class="hljs-keyword">asc</span> | <span class="hljs-keyword">desc</span>]]                            # 排序查询<br>[<span class="hljs-keyword">limit</span> &lt;偏移量&gt;,&lt;行数&gt;]                                           # 分页查询<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>一定要有这样的思想，除了普通查询，其他的都是 JB 条件查询懂吗，包括子查询，例如找出每个部分工资最高的员工，条件就是：员工是要每个部门工资最高的有两个条件，</li>
</ol>
</blockquote>
<blockquote>
<p>[!NOTE] 注意事项：<br>2. <font color="#00b0f0">子查询</font>：<br>    - 子查询的结果可以看作是一个<strong>虚拟表</strong>，<strong>类似于视图</strong>，之后可以在这个虚拟表上进行进一步的查询操作<br>    - <code>virtual-table-alias</code> 就是我们为这个虚拟表起的别名，方便在后续引用这个表<br>    - 子查询内部还可以包含其他子查询，实现多层嵌套，但需注意避免无限嵌套<br>3. <font color="#00b0f0">distinct</font>：<br>    - 用于去除重复记录<br>4. <font color="#00b0f0">SQL 执行顺序（☆☆☆）</font>：<br>    - FROM -&gt; JOIN -&gt; WHERE -&gt; GROUP BY -&gt; HAVING -&gt; SELECT -&gt; DISTINCT -&gt; ORDER BY -&gt; LIMIT &#x2F; OFFSET<br>5. <font color="#00b0f0">condition 怎么写</font>:<br>    -<br>6. <font color="#00b0f0">having-condition 怎么写</font>:<br>    -<br>可以有多个字段，用逗号隔开<br>[!NOTE] 注意：<code>WHERE</code> 与 <code>HAVING</code> 的区别</p>
<ol>
<li>执行时机不同</li>
<li><code>WHERE</code> ：在分组之前进行条件过滤，不满足条件的记录不会参与分组。</li>
<li><code>HAVING</code>：在分组之后对结果进行过滤。</li>
<li>判断条件不同</li>
<li>切操作需遵循 SQL 执行顺序。在为表起别名之前，我们可以直接使用表名；但一旦为表指定了别名，之后必须使用别名，不能再使用原表名。</li>
<li>列明类？</li>
<li></li>
<li><code>WHERE</code> 不能对聚合函数进行判断，而 <code>HAVING</code> 可以</li>
</ol>
</blockquote>
<hr>
<h5 id="4-5-2-基本查询"><a href="#4-5-2-基本查询" class="headerlink" title="4.5.2. 基本查询"></a>4.5.2. 基本查询</h5><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> id, order_date <span class="hljs-keyword">as</span> orderDate <span class="hljs-keyword">from</span> my_table <span class="hljs-keyword">where</span> id &gt;<span class="hljs-number">20</span>; <br><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> my_table<br></code></pre></td></tr></table></figure>

<hr>
<h5 id="4-5-3-分组查询"><a href="#4-5-3-分组查询" class="headerlink" title="4.5.3. 分组查询"></a>4.5.3. 分组查询</h5><h6 id="4-5-3-1-分组查询概述"><a href="#4-5-3-1-分组查询概述" class="headerlink" title="4.5.3.1. 分组查询概述"></a>4.5.3.1. 分组查询概述</h6><p>关于分组查询，首先我们要理解分组的概念：可以这样简单理解，当我们在一张表中，发现<strong>某一列的值出现了多次</strong>，我们就可以按照这一列的值把数据分成一组一组的，这就是“分组”的基本概念。</p>
<p>举个例子：假设你是一家公司的老板，你有很多员工，每个员工都有所属的部门（比如：技术部、市场部、财务部……）。现在你想统计每个部门一个月要发多少工资 —— 这时候，你就可以按照“部门”这个字段来进行分组。也就是说：把属于同一个部门的员工聚在一起（分组），然后对每组员工的工资进行汇总（比如求和）。</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-meta"># 1. 工资超过 100 元的员工所在部门的 部门总工资</span><br><span class="hljs-keyword">select</span> department, <span class="hljs-keyword">count</span>(staff_id) <span class="hljs-keyword">as</span> staff_count, <span class="hljs-keyword">sum</span>(amount) <span class="hljs-keyword">as</span> total_amounts<br><span class="hljs-keyword">from</span> employees<br><span class="hljs-keyword">where</span> amount &gt; <span class="hljs-number">100</span><br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> department<br>having <span class="hljs-keyword">sum</span>(amount) &gt; <span class="hljs-number">350</span>;<br><br><br><span class="hljs-meta"># 2. 统计各个工作地址上班的男性员工和女性员工的数量（根据工作地址、性别分组）、</span><br><span class="hljs-keyword">select</span> workaddress,gender,<span class="hljs-keyword">count</span>(*) <span class="hljs-string">&#x27;amount&#x27;</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gender,workaddress;<br><br><br><span class="hljs-meta"># 3. 查询年龄小于45的员工，根据不同工作地址，获取员工数量大于3的工作地址（根据工作地址分组）</span><br><span class="hljs-keyword">select</span> workaddress,<span class="hljs-keyword">count</span>(*) address_count <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age &lt; <span class="hljs-number">45</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> workaddress having address_count &gt; <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>分组查询 <code>99%</code> 的情况下，要与函数结合进行查询</li>
</ol>
</blockquote>
<hr>
<h6 id="4-5-3-2-实际案例"><a href="#4-5-3-2-实际案例" class="headerlink" title="4.5.3.2. 实际案例"></a>4.5.3.2. 实际案例</h6><p>假设我们有一个员工表 <code>employees</code>，包含 <code>staff_id</code>（员工ID）、<code>department</code>（部门）和 <code>amount</code>（工资）等字段，现在我们要统计每个部门中，需要下发工资总额大于 400 的部门。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> department, <span class="hljs-built_in">count</span>(staff_id) <span class="hljs-keyword">as</span> staff_count, <span class="hljs-built_in">sum</span>(amount) <span class="hljs-keyword">as</span> total_amounts<br><span class="hljs-keyword">from</span> employees<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> department<br><span class="hljs-keyword">having</span> <span class="hljs-built_in">sum</span>(amount) &gt; <span class="hljs-number">350</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410141156407.png" srcset="/img/loading.gif" lazyload></p>
<p>&#x3D;&#x3D;1.SQL 执行：FROM -&gt; JOIN -&gt; WHERE&#x3D;&#x3D;<br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410141156407.png" srcset="/img/loading.gif" lazyload></p>
<p>&#x3D;&#x3D;2.SQL 执行：-&gt; GROPY BY&#x3D;&#x3D;<br>可以<strong>理解为</strong>，相同组的数据被归类到一起，形成了很多表（当然这是不可能的）例如：</p>
<ol>
<li><p><strong>归类1</strong><br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145608083.png" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p><strong>归类2</strong><br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145637852.png" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p><strong>归类3</strong><br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145648701.png" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p><strong>归类4</strong><br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145658659.png" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p><strong>归类5</strong><br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145805811.png" srcset="/img/loading.gif" lazyload></p>
</li>
</ol>
<p>&#x3D;&#x3D;3.SQL 执行：-&gt; HAVING&#x3D;&#x3D;<br>HAVING 对前面分组后的数据进行了筛选。</p>
<ol>
<li><p><strong>筛选1</strong><br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145817283.png" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p><strong>筛选2</strong><br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410145951287.png" srcset="/img/loading.gif" lazyload></p>
</li>
</ol>
<p>&#x3D;&#x3D;4.SQL 执行：-&gt; SELECT -&gt; DISTINCT -&gt; ORDER BY -&gt; LIMIT &#x2F; OFFSET&#x3D;&#x3D;<br><code>SELECT</code> 可以<strong>理解为</strong>对前面筛选出来的多个表分别执行查询操作，然后将结果聚合成一个表。</p>
<ol>
<li><p><strong>查询1</strong><br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410150044456.png" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p><strong>查询2</strong><br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410150052131.png" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p><strong>聚合</strong><br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410150102998.png" srcset="/img/loading.gif" lazyload></p>
</li>
</ol>
<hr>
<h5 id="4-5-4-排序查询"><a href="#4-5-4-排序查询" class="headerlink" title="4.5.4. 排序查询"></a>4.5.4. 排序查询</h5><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-meta"># 1. 根据年龄，对员工进行升序排序</span><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age;<br><br><br><span class="hljs-meta"># 2. 根据入职时间，对员工进行降序排序</span><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> entrydate <span class="hljs-keyword">desc</span>;<br><br><br><span class="hljs-meta"># 3. 根据年龄对员工进行升序排序，若年龄相同，再按照入职时间进行降序排序</span><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">asc</span>,entrydate <span class="hljs-keyword">desc</span>;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li><font color="#00b0f0">排序方式</font>：<ul>
<li><font color="#7030a0">ASC（默认）</font>：升序</li>
<li><font color="#7030a0">DESC</font>：降序</li>
</ul>
</li>
<li>若有多个字段，先按第一个字段排序；若第一个字段中存在相同值，则在这些相同值的数据行中，按第二个字段继续排序。</li>
</ol>
</blockquote>
<hr>
<h5 id="4-5-5-分页查询"><a href="#4-5-5-分页查询" class="headerlink" title="4.5.5. 分页查询"></a>4.5.5. 分页查询</h5><p>表的记录可能会有几百万到上亿条记录，显示所有数据是不现实和低效率的，所以我们通常会在网站中进行分页，每页的数据就是根据分页查询做到的</p>
<p>计算方法：设起始行数为 n ，行数为 m ，从 n + 1 开始显示数据的，共显示 m 行数据</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"># 1. 若每页 6 条记录，查询第一页数据<br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">6</span>;<br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">limit</span> <span class="hljs-number">6</span>;<br><br># 2. 若每页 6 条记录，查询第二页数据<br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">limit</span> <span class="hljs-number">6</span>,<span class="hljs-number">12</span>;<br><br># 3. 若每页 6 条记录，查询第三页数据<br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">limit</span> <span class="hljs-number">12</span>,<span class="hljs-number">6</span>;<br></code></pre></td></tr></table></figure>

<hr>
<h5 id="4-5-6-多表联查"><a href="#4-5-6-多表联查" class="headerlink" title="4.5.6. 多表联查"></a>4.5.6. 多表联查</h5><h6 id="4-5-6-1-多表联查和外键约束的关系"><a href="#4-5-6-1-多表联查和外键约束的关系" class="headerlink" title="4.5.6.1. 多表联查和外键约束的关系"></a>4.5.6.1. 多表联查和外键约束的关系</h6><p>多表联查和外键约束本身并没有直接关系。外键约束主要用于保证数据的完整性，而不会直接影响联查的执行。</p>
<p>然而，进行多表联查时，通常是基于外键字段进行匹配查询的。例如，表 A 的 <code>dept_id</code> 外键与表 B 的 <code>dept_id</code> 进行关联，我们一般通过 <code>a.dept_id = b.dept_id</code> 来匹配数据。</p>
<hr>
<h6 id="4-5-6-2-笛卡尔积问题"><a href="#4-5-6-2-笛卡尔积问题" class="headerlink" title="4.5.6.2. 笛卡尔积问题"></a>4.5.6.2. 笛卡尔积问题</h6><p>执行多表查询时，若直接使用 <code>select * from emp,dept;</code> 执行结果有笛卡尔积问题：<br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410161532467.png" srcset="/img/loading.gif" lazyload></p>
<p>在 SQL 语句中，如何去除无效的笛卡尔积？给多表查询加上连接查询的条件即可 <code>select * from emp,dept where emp.dept_id = dept.id;</code> 执行结果如下：<br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410161552865.png" srcset="/img/loading.gif" lazyload></p>
<hr>
<h6 id="4-5-6-3-数据准备"><a href="#4-5-6-3-数据准备" class="headerlink" title="4.5.6.3. 数据准备"></a>4.5.6.3. 数据准备</h6><p>假设我们有 <code>employees</code>（员工表）和 <code>departments</code>（部门表）：</p>
<p>&#x3D;&#x3D;1.employess 表&#x3D;&#x3D;<br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410165218847.png" srcset="/img/loading.gif" lazyload></p>
<p>&#x3D;&#x3D;2.departments 表&#x3D;&#x3D;<br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410162851472.png" srcset="/img/loading.gif" lazyload></p>
<hr>
<h6 id="4-5-6-4-内连接"><a href="#4-5-6-4-内连接" class="headerlink" title="4.5.6.4. 内连接"></a>4.5.6.4. 内连接</h6><p>内连接是最常用的连接方式。当连接条件（如 <code>e.department_id = d.department_id</code>）满足时，它会返回两个表中所有符合条件的行及其所有列（满足才返回，不满足不返回）。之后，我们可以对结果应用 <code>SELECT</code> 和 <code>HAVING</code> 进行进一步筛选，最终得到查询结果。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> <br>    <span class="hljs-built_in">e</span>.first_name, <br>    <span class="hljs-built_in">e</span>.last_name, <br>    <span class="hljs-built_in">e</span>.salary, <br>    d.department_name,<br>    d.location<br><span class="hljs-keyword">from</span> <br>    employees <span class="hljs-keyword">as</span> <span class="hljs-built_in">e</span><br><span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> <br>    departments <span class="hljs-keyword">as</span> d <span class="hljs-keyword">on</span> <span class="hljs-built_in">e</span>.department_id = d.department_id;<br></code></pre></td></tr></table></figure>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410165304264.png" srcset="/img/loading.gif" lazyload></p>
<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>根据 SQL 执行顺序，先执行 <code>FROM</code>，再执行 <code>JOIN</code>，因此在 <code>FROM</code> 和 <code>INNER JOIN</code> 中为表指定的别名，可以在整个查询中使用。</li>
<li>切操作需遵循 SQL 执行顺序。在为表起别名之前，我们可以直接使用表名；但一旦为表指定了别名，之后必须使用别名，不能再使用原表名。</li>
</ol>
</blockquote>
<hr>
<h6 id="4-5-6-5-左连接"><a href="#4-5-6-5-左连接" class="headerlink" title="4.5.6.5. 左连接"></a>4.5.6.5. 左连接</h6><p>左连接会返回左表的所有行和所有列，无论连接条件是否满足。当连接条件（如 <code>e.department_id = d.department_id</code>）满足时，右表会返回匹配的行及其所有列；如果连接条件不满足（如 <code>e.department_id != d.department_id</code>），右表的列则会返回 <code>NULL</code>。之后，我们可以对结果应用 <code>SELECT</code> 和 <code>HAVING</code> 进行进一步筛选，最终得到查询结果。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> <br>    <span class="hljs-built_in">e</span>.first_name, <br>    <span class="hljs-built_in">e</span>.last_name, <br>    <span class="hljs-built_in">e</span>.salary, <br>    d.department_name<br><span class="hljs-keyword">from</span> <br>    employees <span class="hljs-built_in">e</span><br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> <br>    departments d <span class="hljs-keyword">on</span> <span class="hljs-built_in">e</span>.department_id = d.department_id;<br></code></pre></td></tr></table></figure>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410165415783.png" srcset="/img/loading.gif" lazyload></p>
<hr>
<h6 id="4-5-6-6-右连接"><a href="#4-5-6-6-右连接" class="headerlink" title="4.5.6.6. 右连接"></a>4.5.6.6. 右连接</h6><p>和左连接类似，只不过是右表提供所有数据</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> <br>    <span class="hljs-built_in">e</span>.first_name, <br>    <span class="hljs-built_in">e</span>.last_name, <br>    <span class="hljs-built_in">e</span>.salary, <br>    d.department_name<br><span class="hljs-keyword">from</span> <br>    employees <span class="hljs-built_in">e</span><br><span class="hljs-keyword">right</span> <span class="hljs-keyword">join</span> <br>    departments d <span class="hljs-keyword">on</span> <span class="hljs-built_in">e</span>.department_id = d.department_id;<br></code></pre></td></tr></table></figure>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410165544009.png" srcset="/img/loading.gif" lazyload></p>
<hr>
<h6 id="4-5-6-7-自连接"><a href="#4-5-6-7-自连接" class="headerlink" title="4.5.6.7. 自连接"></a>4.5.6.7. 自连接</h6><p>自连接是将同一表与自身进行连接，常用于需要比较同一表中不同记录的情况。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> a.column1, b.column1<br><span class="hljs-keyword">FROM</span> table_a a<br><span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> table_a b <span class="hljs-keyword">ON</span> a.common_column = b.common_column<br><span class="hljs-keyword">WHERE</span> a.id != b.id;  <span class="hljs-comment">-- 防止自身匹配</span><br></code></pre></td></tr></table></figure>

<hr>
<h6 id="一对一查询"><a href="#一对一查询" class="headerlink" title="一对一查询"></a>一对一查询</h6><p>我们上面讲的内连接、左连接、右连接都很适合进行一对一查询。以 <code>Employee</code> 表和 <code>WorkCard</code> 表为例，<code>Employee</code> 表中的每个员工都有一个唯一的 <code>EmpID</code>，而 <code>WorkCard</code> 表中的每个工作证都对应一个唯一的员工。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> Employee 表（主表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Employee (<br>    EmpID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    <span class="hljs-type">Name</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>)<br>);<br><br><br># <span class="hljs-number">2.</span> WorkCard 表（从表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> WorkCard (<br>    CardID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    EmpID <span class="hljs-type">INT</span>, // 从表的外键字段 -&gt; 主表的字段（一般命名相同）<br>    IssueDate <span class="hljs-type">DATE</span>,<br>    <span class="hljs-keyword">FOREIGN KEY</span> (EmpID) <span class="hljs-keyword">REFERENCES</span> Employee(EmpID)<br>);<br><br><br># <span class="hljs-number">3.</span> 一对一查询（以内连接为例）<br><span class="hljs-keyword">SELECT</span> <br>  e.EmpID,<br>  e.Name,<br>  w.CardID,<br>  w.IssueDate<br><span class="hljs-keyword">FROM</span> <br>  WorkCard w<br><span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <br>  Employee e // <span class="hljs-keyword">FROM</span> 从 <span class="hljs-keyword">JOIN</span> 主<br><span class="hljs-keyword">ON</span> <br>  e.EmpID = w.EmpID;<br></code></pre></td></tr></table></figure>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521211043750.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521211108505.png" srcset="/img/loading.gif" lazyload></p>
<hr>
<h6 id="一对多查询"><a href="#一对多查询" class="headerlink" title="一对多查询"></a>一对多查询</h6><p>我们上面讲的内连接、左连接、右连接同样也都很适合进行一对多查询。假设有 <code>Department</code>（部门表）和 <code>Employee</code>（员工表）。一个部门有多个员工，每个员工属于一个部门。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> Department 表（主表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Department (<br>    DeptID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    DeptName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>)<br>);<br><br><br># <span class="hljs-number">2.</span> Employee 表（从表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Employee (<br>    EmpID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    <span class="hljs-type">Name</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    DeptID <span class="hljs-type">INT</span>, // 从表的外键字段 -&gt; 主表的字段（一般命名相同）<br>    <span class="hljs-keyword">FOREIGN KEY</span> (DeptID) <span class="hljs-keyword">REFERENCES</span> Department(DeptID)<br>);<br><br><br># <span class="hljs-number">3.</span> 一对多查询（以内连接为例）<br><span class="hljs-keyword">SELECT</span> <br>  e.EmpID,<br>  e.Name,<br>  d.DeptName<br><span class="hljs-keyword">FROM</span> <br>  Employee e<br><span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <br>  Department d<br><span class="hljs-keyword">ON</span> <br>  e.DeptID = d.DeptID;<br></code></pre></td></tr></table></figure>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521212132677.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521212154361.png" srcset="/img/loading.gif" lazyload></p>
<hr>
<h6 id="多对多查询"><a href="#多对多查询" class="headerlink" title="多对多查询"></a>多对多查询</h6><p>多对多查询的关键在于：查中间表，并对左右两侧的主表各做一次连接。假设有 <code>Student</code>（学生表）和 <code>Course</code>（课程表），一个学生可以选修多门课程，而每门课程可以有多个学生选修。我们需要一个中间表 <code>Enrollment</code> 来记录学生与课程之间的关系。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> Student 表（主表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Student (<br>    StudentID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    <span class="hljs-type">Name</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>)<br>);<br><br><br># <span class="hljs-number">2.</span> Course 表（主表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Course (<br>    CourseID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    CourseName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>)<br>);<br><br><br># <span class="hljs-number">3.</span> Enrollment 表（从表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Enrollment (<br>    StudentID <span class="hljs-type">INT</span>,<br>    CourseID <span class="hljs-type">INT</span>,<br>    <span class="hljs-keyword">PRIMARY KEY</span> (StudentID, CourseID),<br>    <span class="hljs-keyword">FOREIGN KEY</span> (StudentID) <span class="hljs-keyword">REFERENCES</span> Student(StudentID),<br>    <span class="hljs-keyword">FOREIGN KEY</span> (CourseID) <span class="hljs-keyword">REFERENCES</span> Course(CourseID)<br>);<br><br><br># <span class="hljs-number">4.</span> 多对多查询<br><span class="hljs-keyword">SELECT</span><br>  s.Name <span class="hljs-keyword">AS</span> 学生名,<br>  c.CourseName <span class="hljs-keyword">AS</span> 课程名<br><span class="hljs-keyword">FROM</span><br>  Enrollment e // 中间表<br><span class="hljs-keyword">JOIN</span><br>  Student s <span class="hljs-keyword">ON</span> e.StudentID = s.StudentID // 第一次 <span class="hljs-keyword">JOIN</span>：连接学生<br><span class="hljs-keyword">JOIN</span><br>  Course c <span class="hljs-keyword">ON</span> e.CourseID = c.CourseID // 第二次 <span class="hljs-keyword">JOIN</span>：连接课程<br></code></pre></td></tr></table></figure>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250522101521175.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250522101539693.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250522101559348.png" srcset="/img/loading.gif" lazyload></p>
<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>我们平时常见的是两个实体之间的多对多关系，但其实三个甚至更多实体之间也能形成多对多关系，也是一个中间表。查询的时候，只要用中间表，多次连接相关表，就能把信息都查出来。</li>
</ol>
</blockquote>
<hr>
<h5 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h5><p>子查询可以出现在 SQL 的三个位置。现在你只需要先记住最常见的一种用法：写在 <code>WHERE</code> 后面，用于筛选数据。</p>
<table>
<thead>
<tr>
<th>放置位置</th>
<th>示例</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>WHERE</code> 后</td>
<td><code>WHERE id IN (SELECT id FROM ...)</code></td>
<td>筛选数据</td>
</tr>
<tr>
<td><code>SELECT</code> 中</td>
<td><code>SELECT (SELECT AVG(score) ...) AS avg_score</code></td>
<td>字段值计算</td>
</tr>
<tr>
<td><code>FROM</code> 中</td>
<td><code>FROM (SELECT ...) AS temp</code></td>
<td>临时表、组合逻辑</td>
</tr>
</tbody></table>
<p>当你看到以下几种场景时，通常意味着可能要用到子查询了：</p>
<ol>
<li>&#x3D;&#x3D;存在性判断&#x3D;&#x3D;：<ol>
<li>关键词：<ol>
<li>存在、不存在、是否在，</li>
<li>简单来说，就是在问 “<strong>有没有？</strong>”</li>
</ol>
</li>
<li>例如示例：<ol>
<li>哪些项目没有使用红色零件？</li>
<li>找出未使用红色零件的项目</li>
</ol>
</li>
<li>注意事项：<ol>
<li>如果是“有”的情况（如：某些项目使用了红色零件），通常 直连 即可。</li>
<li>如果是“没有”的情况（如：哪些项目没有使用红色零件），大概率需要用 子查询 来排除。</li>
</ol>
</li>
</ol>
</li>
<li>&#x3D;&#x3D;极值查询&#x3D;&#x3D;：<ol>
<li>关键词：<ol>
<li>最大、最小、前几名</li>
</ol>
</li>
</ol>
</li>
<li>&#x3D;&#x3D;集合比较&#x3D;&#x3D;：<ol>
<li>关键词：<ol>
<li>全部、至少、包含</li>
</ol>
</li>
</ol>
</li>
<li>&#x3D;&#x3D;字段间的比较用到全表的动态值&#x3D;&#x3D;：</li>
</ol>
<hr>
<h4 id="4-6-DCL（用户、角色管理）"><a href="#4-6-DCL（用户、角色管理）" class="headerlink" title="4.6. DCL（用户、角色管理）"></a>4.6. DCL（用户、角色管理）</h4><h5 id="4-6-1-用户管理"><a href="#4-6-1-用户管理" class="headerlink" title="4.6.1. 用户管理"></a>4.6.1. 用户管理</h5><p>&#x3D;&#x3D;1.创建用户&#x3D;&#x3D;</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ceylon">create user <span class="hljs-string">&#x27;&lt;用户名&gt;&#x27;</span>@<span class="hljs-string">&#x27;&lt;主机地址&gt;&#x27;</span> identified <span class="hljs-meta">by</span> <span class="hljs-string">&#x27;密码&#x27;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">1. 主机地址：</span><br><span class="hljs-string">	1. 主机地址可以为 %，允许该用户从任何主机连接到 MySQL 数据库</span><br><span class="hljs-string">	2. 例如：&#x27;user&#x27;@&#x27;%&#x27;，表示无论什么 IP，只要你是 user 用户，就都能连接到数据库</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;2.删除用户&#x3D;&#x3D;</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;用户名&#x27;</span>@<span class="hljs-string">&#x27;主机地址&#x27;</span>;<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;3.更新用户&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> 修改用户密码<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;用户名&#x27;</span>@<span class="hljs-string">&#x27;主机地址&#x27;</span> identified <span class="hljs-keyword">with</span> mysql_native_password <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;新密码&#x27;</span>;<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;4.查询用户&#x3D;&#x3D;</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-meta"># 1. 查询有哪些用户</span><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> mysql.user;<br><br><br><span class="hljs-meta"># 2. 查询用户的权限</span><br>show crants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;用户名&#x27;</span>@<span class="hljs-string">&#x27;主机地址&#x27;</span>;<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;5.授予用户权限&#x3D;&#x3D;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1. 授予用户权限</span><br>grant &lt;权限列表,&gt; on &lt;数据库名&gt;.&lt;表名&gt; to <span class="hljs-string">&#x27;&lt;用户名&gt;&#x27;</span>@<span class="hljs-string">&#x27;&lt;主机名&gt;&#x27;</span> [<span class="hljs-keyword">with</span> grant option];<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">1. 注意事项：</span><br><span class="hljs-string">	1. 一个语句一个 &lt;数据库名&gt;.&lt;表名&gt;，如果你非要同时授权多个表，那就得多写几条语句</span><br><span class="hljs-string">	2. 但是我们可以使用 * 表示所有数据库或所有表</span><br><span class="hljs-string">2. 常用权限：</span><br><span class="hljs-string">3. with grant option：</span><br><span class="hljs-string">	1. 用户可以把自己的权限再授权给别的用户</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><br><span class="hljs-comment"># 2. 刷新权限，使其生效</span><br>FLUSH PRIVILEGES;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项：常用权限</p>
<ol>
<li><font color="#00b0f0">ALL PRIVILEGES</font>：授予所有权限</li>
<li><font color="#00b0f0">ALTER</font>：修改数据库、表的结构</li>
<li><font color="#00b0f0">ALTER ROUTINE</font>：修改存储过程或函数</li>
<li><font color="#00b0f0">CREATE</font>：创建数据库、表等对象</li>
<li><font color="#00b0f0">CREATE ROUTINE</font>：创建存储过程或函数</li>
<li><font color="#00b0f0">CREATE TEMPORARY TABLES</font>：创建临时表</li>
<li><font color="#00b0f0">CREATE VIEW</font>：创建视图</li>
<li><font color="#00b0f0">DELETE</font>：删除数据</li>
<li><font color="#00b0f0">DROP</font>：删除数据库、表、视图等对象</li>
<li><font color="#00b0f0">EVENT</font>：管理事件调度</li>
<li><font color="#00b0f0">EXECUTE</font>：执行存储过程或函数</li>
<li><font color="#00b0f0">GRANT OPTION</font>：授予权限</li>
<li><font color="#00b0f0">INDEX</font>：创建和删除索引</li>
<li><font color="#00b0f0">INSERT</font>：插入数据</li>
<li><font color="#00b0f0">LOCK TABLES</font>：锁定表</li>
<li><font color="#00b0f0">REFERENCES</font>：管理外键约束</li>
<li><font color="#00b0f0">SELECT</font>：查询数据</li>
<li><font color="#00b0f0">SHOW VIEW</font>：查看视图的定义</li>
<li><font color="#00b0f0">TRIGGER</font>：创建和删除触发器</li>
<li><font color="#00b0f0">UPDATE</font>：更新数据</li>
<li><font color="#00b0f0">FILE</font>：读取文件</li>
<li><font color="#00b0f0">REPLICATION CLIENT</font>：管理复制客户端，允许查看复制状态</li>
<li><font color="#00b0f0">REPLICATION SLAVE</font>：允许从服务器连接到主服务器进行复制</li>
<li>权限的授予通常基于数据库、表或列的范围。例如，如果你拥有 <font color="#00b0f0">CREATE</font> 权限并且授予到<code>*.*</code>，那么你可以创建数据库和表；但如果权限只授予到 <code>my_repository.*</code>，你只能创建该库下的表，不能创建数据库；如果是 <code>my_repository.my_table</code>，你连表都无法创建。</li>
</ol>
</blockquote>
<p>&#x3D;&#x3D;6.撤销用户权限&#x3D;&#x3D;</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pf">revoke <span class="hljs-variable">&lt;权限列表,&gt;</span> <span class="hljs-keyword">on</span> <span class="hljs-variable">&lt;数据库名&gt;</span>.<span class="hljs-variable">&lt;表名&gt;</span> <span class="hljs-keyword">from</span> &#x27;<span class="hljs-variable">&lt;用户名&gt;</span>&#x27;@&#x27;<span class="hljs-variable">&lt;主机名&gt;</span>&#x27;;<br></code></pre></td></tr></table></figure>

<hr>
<h5 id="4-6-2-角色管理"><a href="#4-6-2-角色管理" class="headerlink" title="4.6.2. 角色管理"></a>4.6.2. 角色管理</h5><p>&#x3D;&#x3D;1.创建角色&#x3D;&#x3D;</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">ROLE</span> <span class="hljs-string">&#x27;角色名&#x27;</span>;<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;2.删除角色&#x3D;&#x3D;</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">role</span> <span class="hljs-string">&#x27;角色名列表(,)&#x27;</span>;<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;3.给角色赋权限&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">grant</span> 权限列表(,) <span class="hljs-keyword">on</span> 库名.表名 <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;角色名列表(,)&#x27;</span>;<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;4.把角色分配给用户 &#x2F; 角色&#x3D;&#x3D;</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta"># 1. 把角色分配给角色</span><br>grant <span class="hljs-string">&#x27;角色名列表(,)&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;角色名列表(,)&#x27;</span><span class="hljs-comment">;</span><br><br><br><span class="hljs-meta"># 2. 把角色分配给用户</span><br>grant <span class="hljs-string">&#x27;角色名列表(,)&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;用户名&#x27;</span>@<span class="hljs-string">&#x27;主机地址&#x27;</span>列表(,)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;5.将分配给用户的角色撤回&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">revoke</span> <span class="hljs-string">&#x27;角色名列表(,)&#x27;</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;用户名&#x27;</span>@<span class="hljs-string">&#x27;主机地址&#x27;</span>列表(,);<br></code></pre></td></tr></table></figure>

<hr>
<h3 id="5-事务管理"><a href="#5-事务管理" class="headerlink" title="5. 事务管理"></a>5. 事务管理</h3><h4 id="5-1-事务的特性"><a href="#5-1-事务的特性" class="headerlink" title="5.1. 事务的特性"></a>5.1. 事务的特性</h4><ol>
<li>&#x3D;&#x3D;原子性&#x3D;&#x3D;<ol>
<li>事务中的所有操作要么全部执行成功，要么全部执行失败回滚。</li>
<li>对于数据库来说，事务是一个不可分割的最小操作单元。</li>
</ol>
</li>
<li>&#x3D;&#x3D;一致性&#x3D;&#x3D;：<ol>
<li>事务执行前后，数据库都处于一致的状态。</li>
<li>也就是说，事务执行前后，数据库的状态应该满足所有的定义约束、触发器、级联操作等。</li>
</ol>
</li>
<li>&#x3D;&#x3D;隔离性&#x3D;&#x3D;：<ol>
<li>事务的执行不会受到其他事务的干扰。</li>
<li>多个事务并发执行时，一个事务的中间状态对其他事务是不可见的。</li>
</ol>
</li>
<li>&#x3D;&#x3D;持久性&#x3D;&#x3D;：<ol>
<li>事务一旦提交，其结果就永久保存到数据库中。</li>
<li>即使系统发生故障，事务的结果也不会丢失。</li>
</ol>
</li>
</ol>
<hr>
<h4 id="5-2-事务提交的方式"><a href="#5-2-事务提交的方式" class="headerlink" title="5.2. 事务提交的方式"></a>5.2. 事务提交的方式</h4><p>一句话：我不管你是<strong>一次操作批量插入</strong>还是<strong>多次操作大量插入</strong>，只要涉及到多个数据，就给我开启手动提交：</p>
<ol>
<li>&#x3D;&#x3D;自动提交&#x3D;&#x3D;：<ol>
<li>在 MySQL 中，默认情况下，每条 SQL 语句都被视为一个独立的事务，并在执行后立即自动提交。</li>
<li>这意味着每条 SQL 语句执行后，数据库会自动处理提交，无需显式使用 <code>COMMIT</code> 命令。</li>
<li>在这种模式下，操作是独立的，无法将多个操作作为一个整体事务进行管理，需要一条一条的执行。</li>
</ol>
</li>
<li>&#x3D;&#x3D;手动提交&#x3D;&#x3D;：<ol>
<li>关闭自动提交，改为手动管理事务，使我们能够自行决定何时提交一组操作。如果其中任一操作失败，事务将回滚至初始状态，确保数据一致性。</li>
</ol>
</li>
</ol>
<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>事务只对 DML 语句有影响，原因是：<ul>
<li>DQL 不受事务影响，因为 DQL 不会对数据库进行改变</li>
<li>DDL 和 DCL 不受事务一下，纯粹是事务管不到他们</li>
</ul>
</li>
</ol>
</blockquote>
<hr>
<h4 id="5-3-自动提交事务"><a href="#5-3-自动提交事务" class="headerlink" title="5.3. 自动提交事务"></a>5.3. 自动提交事务</h4><p>在 MySQL 中，默认启用了自动提交模式：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># 1. 查询是否开启自动提交（1开，0关）</span><br><span class="hljs-attribute">select</span> @<span class="hljs-variable">@autocommit</span>;<br><br><br><span class="hljs-comment"># 2. 开启自动提交</span><br><span class="hljs-attribute">set</span> autocommit = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<hr>
<h4 id="5-4-手动提交事务"><a href="#5-4-手动提交事务" class="headerlink" title="5.4. 手动提交事务"></a>5.4. 手动提交事务</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 1. 查询是否开启自动提交（1开，0关）</span><br><span class="hljs-built_in">select</span> <span class="hljs-selector-tag">@</span>@autocommit;<br><br><br><span class="hljs-comment"># 2. 关闭自动提交</span><br><span class="hljs-built_in">set</span> autocommit = <span class="hljs-number">0</span>;<br><br><br><span class="hljs-comment"># 3. 开始事务</span><br><span class="hljs-built_in">start</span> transaction; / <span class="hljs-keyword">begin</span>;<br><br><br><span class="hljs-comment"># 4. 执行 SQL 操作</span><br>UPDATE accounts <span class="hljs-built_in">SET</span> balance = balance - <span class="hljs-number">100</span> <span class="hljs-built_in">WHERE</span> id = <span class="hljs-number">1</span>;<br>UPDATE accounts <span class="hljs-built_in">SET</span> balance = balance + <span class="hljs-number">100</span> <span class="hljs-built_in">WHERE</span> id = <span class="hljs-number">2</span>;<br><br><br><span class="hljs-comment"># 5. 提交事务 / 回滚事务</span><br><span class="hljs-comment"># 5.1. 提交事务（将事务中的所有操作永久保存到数据库中）</span><br>commit;<br><br><span class="hljs-comment"># 5.2. 回滚事务（撤销事务中的所有操作）</span><br>rollback;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>在 SQL 中，<code>commit</code> 和 <code>rollback</code> 是互斥的，一个事务只能执行其中一个</li>
<li>我们通常是使用编程语言来控制的，成功了就提交，不成功就回滚</li>
</ol>
</blockquote>
<hr>
<h4 id="5-5-事务隔离性问题"><a href="#5-5-事务隔离性问题" class="headerlink" title="5.5. 事务隔离性问题"></a>5.5. 事务隔离性问题</h4><p>以下这三种现象看似与 <strong>查询操作</strong> 相关，但它们本质上是由于 <strong>事务隔离性</strong> 不足，导致<strong>并发事务</strong>之间在数据访问和修改时发生 <strong>冲突</strong>。</p>
<ol>
<li>&#x3D;&#x3D;脏读&#x3D;&#x3D;：<ol>
<li>假设事务 A 正在对某些数据进行增删改操作，但尚未提交，事务 B 需要读取这些数据。如果事务 B 正好读取了事务 A 正在修改的数据，则事务 B 读取到的数据就是 “脏” 的。</li>
<li>这些数据被称为“脏数据”，因为事务 A 可能在后续回滚或再次修改，导致事务 B 读取到的数据实际上未被最终提交，可能会导致错误的业务逻辑，尤其是事务 B 后续依赖这些数据时。</li>
</ol>
</li>
<li>&#x3D;&#x3D;不可重复读&#x3D;&#x3D;：<ol>
<li>发生在 <strong>同一事务</strong> 内 <strong>多次查询</strong> <strong>同一行数据</strong> 时。</li>
<li>例如，事务 B 初次查询某行数据，然后事务 A 对这行数据进行了<strong>修改</strong>或<strong>删除</strong>。如果事务 B 再次查询同一行数据，会发现读取到的数据发生了变化，导致 <strong>不可重复读</strong>。</li>
</ol>
</li>
<li>&#x3D;&#x3D;幻读&#x3D;&#x3D;：<ol>
<li>发生在 <strong>同一事务</strong> 内 <strong>多次查询</strong> <strong>结果集</strong> 时</li>
<li>例如，事务 B 查询某个条件范围的数据（如 <code>age &gt; 50</code>），然后事务 A 向该范围内<strong>插入</strong>数据。事务 B 再次查询时，发现数据集发生了变化，查询结果与第一次查询不同，这就是 <strong>幻读</strong>。（只有插入才会导致幻读，更新、删除不会导致幻读）</li>
</ol>
</li>
</ol>
<hr>
<h4 id="5-6-事务隔离级别"><a href="#5-6-事务隔离级别" class="headerlink" title="5.6. 事务隔离级别"></a>5.6. 事务隔离级别</h4><h5 id="5-6-1-READ-UNCOMMITTED（读未提交）"><a href="#5-6-1-READ-UNCOMMITTED（读未提交）" class="headerlink" title="5.6.1. READ UNCOMMITTED（读未提交）"></a>5.6.1. READ UNCOMMITTED（读未提交）</h5><ol>
<li>&#x3D;&#x3D;执行 查询 语句&#x3D;&#x3D;：<ol>
<li>查询语句本身不会对数据加锁，因此其他事务仍然可以对相关数据执行增删改查操作，可能导致 <strong>不可重复读</strong> 和 <strong>幻读</strong></li>
<li>如果查询的数据正好被其他事务修改，则会发生发生 <strong>脏读</strong></li>
<li>简单来说：查询有 脏读、不可重复读、幻读 问题</li>
</ol>
</li>
<li>&#x3D;&#x3D;执行 增、删、改 语句&#x3D;&#x3D;：<ol>
<li>对操作的数据，会加上行级排他锁（X锁），防止其他事务对这些数据进行增删改操作（可以读取数据，具体是进行脏读还是读取已提交的版本，取决于它的事务的隔离级别）。X锁会一直保持，直到事务结束（提交或回滚）时释放</li>
<li>如果数据正在被其他事务操作且已加锁，会产生锁冲突，当前事务会等待对方事务结束（提交或回滚），然后再加锁并执行操作。</li>
<li>如果数据未被锁定，则可以直接进行增删改操作。</li>
</ol>
</li>
<li>&#x3D;&#x3D;使用场景&#x3D;&#x3D;:<ol>
<li>数据一致性要求不高，性能最高</li>
</ol>
</li>
</ol>
<hr>
<h5 id="5-6-2-READ-COMMITTED（读已提交，默认）"><a href="#5-6-2-READ-COMMITTED（读已提交，默认）" class="headerlink" title="5.6.2. READ COMMITTED（读已提交，默认）"></a>5.6.2. READ COMMITTED（读已提交，默认）</h5><ol>
<li>&#x3D;&#x3D;执行 查询 语句&#x3D;&#x3D;：<ol>
<li>查询语句<strong>不会对数据加锁</strong>，因此其他事务仍然可以对相关数据执行增删改查操作，可能导致 <strong>不可重复读</strong> 和 <strong>幻读</strong></li>
<li>查询语句<strong>仅读取其他事务已提交的最新数据版本</strong>（<strong>避免脏读</strong>，不会等待提交，直接找最近提交的）。</li>
<li>简单来说：查询有 不可重复读、幻读 问题</li>
</ol>
</li>
<li>&#x3D;&#x3D;执行 增、删、改 语句&#x3D;&#x3D;：<ol>
<li>对操作的数据，会加上<strong>行级排他锁（X锁）</strong>，防止其他事务对这些数据进行增删改操作（可以读取数据，具体是进行脏读还是读取已提交的版本，取决于它的事务的隔离级别）。X锁会一直保持，直到事务结束（提交或回滚）时释放</li>
<li>如果数据正在被其他事务操作且已加锁，会产生锁冲突，当前事务会等待对方事务结束（提交或回滚），然后再加锁并执行操作。</li>
<li>如果数据未被锁定，则可以直接进行增删改操作。</li>
</ol>
</li>
<li>&#x3D;&#x3D;使用场景&#x3D;&#x3D;：<ol>
<li>数据库的默认隔离级别，日常用这个就行，不可重复读、幻读这些都是小问题，谁还真一次事务执行多次查询啊</li>
</ol>
</li>
</ol>
<hr>
<h5 id="5-6-3-REPEATABLE-READ（可重复读）"><a href="#5-6-3-REPEATABLE-READ（可重复读）" class="headerlink" title="5.6.3. REPEATABLE READ（可重复读）"></a>5.6.3. REPEATABLE READ（可重复读）</h5><ol>
<li>&#x3D;&#x3D;执行 查询 语句&#x3D;&#x3D;：<ol>
<li>查询语句虽然<strong>不会对数据加锁</strong>，因此其他事务仍然可以对相关数据执行增删改查操作</li>
<li><strong>但会</strong>在首次查询时创建一个 <strong>一致性数据快照</strong>。后续的查询将基于此快照进行，确保数据一致性。<ol>
<li>如果其他事务对数据进行删除或修改操作，这些变动不会影响快照的内容。因此，后续查询结果与第一次查询一致，避免了<strong>不可重复读</strong>。</li>
<li>然而，<strong>幻读</strong>仍然可能发生。若其他事务插入了符合查询条件的新记录（例如，<code>age &gt; 25</code>），那么在事务 A 下一次查询时，新增的记录会出现在查询结果中，导致两次查询结果不同，从而产生<strong>幻读</strong>。</li>
</ol>
</li>
<li>查询语句<strong>仅读取其他事务已提交的最新数据版本</strong>（<strong>避免脏读</strong>，不会等待提交，直接找最近提交的）。</li>
<li>简单来说：查询有 幻读 问题</li>
</ol>
</li>
<li>&#x3D;&#x3D;执行 增、删、该 语句&#x3D;&#x3D;：<ol>
<li>对操作数据加<strong>行级排他锁（X锁）</strong>，并对<strong>数据范围</strong>的 <strong>“间隙” 加锁</strong>（例如，当 <code>WHERE id &gt; 100</code> 时，锁定 <code>id &gt; 100</code> 的区间，注意是区间，不是行数据），以阻止其他事务插入或修改该区间的数据（可以读取数据，具体是进行脏读还是读取已提交的版本，取决于它的事务的隔离级别）</li>
<li>如果数据正在被其他事务操作且已加锁，会产生锁冲突，当前事务会等待对方事务结束（提交或回滚），然后再加锁并执行操作。</li>
<li>如果数据未被锁定，则可以直接进行增删改操作。</li>
</ol>
</li>
<li>&#x3D;&#x3D;使用场景&#x3D;&#x3D;：<ol>
<li>一致性较高</li>
</ol>
</li>
</ol>
<hr>
<h5 id="5-6-4-SERIALIZABLE（可串行化）"><a href="#5-6-4-SERIALIZABLE（可串行化）" class="headerlink" title="5.6.4. SERIALIZABLE（可串行化）"></a>5.6.4. SERIALIZABLE（可串行化）</h5><ol>
<li>&#x3D;&#x3D;执行 查询 语句&#x3D;&#x3D;：<ol>
<li>查询语句会对数据加 共享锁（S锁），并对<strong>数据范围</strong>的 <strong>“间隙” 加锁</strong>（例如，当 <code>WHERE id &gt; 100</code> 时，锁定 <code>id &gt; 100</code> 的区间，注意是区间，不是行数据）以阻止其他事务插入或修改该区间的数据（可以读取数据，具体是进行脏读还是读取已提交的版本，取决于它的事务的隔离级别）</li>
<li>若使用索引查询，锁定匹配的索引范围和间隙</li>
<li>若全表扫描，可能直接加表级锁</li>
<li>简单来说：查询无 脏读、不可重复度、幻读 问题</li>
</ol>
</li>
<li>&#x3D;&#x3D;执行 增、删、该 语句&#x3D;&#x3D;：<ol>
<li>对操作数据加<strong>行级排他锁（X锁）</strong>，并对<strong>数据范围</strong>的 <strong>“间隙” 加锁</strong>（例如，当 <code>WHERE id &gt; 100</code> 时，锁定 <code>id &gt; 100</code> 的区间，注意是区间，不是行数据），以阻止其他事务插入或修改该区间的数据（可以读取数据，具体是进行脏读还是读取已提交的版本，取决于它的事务的隔离级别）</li>
<li>如果数据正在被其他事务操作且已加锁，会产生锁冲突，当前事务会等待对方事务结束（提交或回滚），然后再加锁并执行操作。</li>
<li>如果数据未被锁定，则可以直接进行增删改操作。</li>
</ol>
</li>
<li>&#x3D;&#x3D;使用场景&#x3D;&#x3D;：<ol>
<li>一致性最高，性能最低</li>
</ol>
</li>
</ol>
<hr>
<h3 id="6-数据分区"><a href="#6-数据分区" class="headerlink" title="6. 数据分区"></a>6. 数据分区</h3><hr>
<h3 id="7-MySQL-约束"><a href="#7-MySQL-约束" class="headerlink" title="7. MySQL 约束"></a>7. MySQL 约束</h3><h4 id="7-1-约束概述"><a href="#7-1-约束概述" class="headerlink" title="7.1. 约束概述"></a>7.1. 约束概述</h4><p>约束是数据库中用于限制和控制<strong>列上数据</strong>完整性的一种规则。</p>
<p>我的策略是：除了主键约束，其他约束都在表创建后再添加约束。</p>
<hr>
<h4 id="7-2-常用约束"><a href="#7-2-常用约束" class="headerlink" title="7.2. 常用约束"></a>7.2. 常用约束</h4><p>&#x3D;&#x3D;1.主键约束&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>约束类型</th>
<th>关键字</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>主键约束</strong></td>
<td><code>PRIMARY KEY</code></td>
<td>用于确保列中的每个<strong>值唯一</strong>且<strong>不能为空</strong>，通常主键列还会<strong>设置自增属性</strong>以便自动生成唯一值。每个表只能有一个主键。<br></td>
</tr>
<tr>
<td><strong>自增属性</strong></td>
<td><code>AUTO_INCREMENT</code></td>
<td>不是传统意义上的约束，而是一种属性，用于为整数类型的列设置自增功能，自动为该列生成唯一的数字值。<strong>通常用于主键列。</strong><br></td>
</tr>
</tbody></table>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> 主键约束<br># <span class="hljs-number">1.1</span>. 添加主键约束<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> &lt;<span class="hljs-keyword">constraint</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">primary key</span> (&lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt;);<br><br># <span class="hljs-number">1.2</span>. 删除主键约束（自动删除唯一索引）<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">drop</span> <span class="hljs-keyword">primary key</span>;<br><br><br># <span class="hljs-number">2.</span> 自增属性<br># <span class="hljs-number">2.1</span>. 添加自增属性<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; modify &lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt; &lt;data-<span class="hljs-keyword">type</span>&gt; auto_increment;<br><br># <span class="hljs-number">2.2</span>. 删除自增属性<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; modify &lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt; &lt;data-<span class="hljs-keyword">type</span>&gt;;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项：</p>
<ol>
<li>主键约束会自动添加 <strong>非空约束</strong> 和 <strong>唯一约束</strong>，并创建 <strong>主键索引</strong>（该索引本身也是唯一索引的一种形式，因此保证了每个值的唯一性）。通常情况下，主键列还会设置为 <strong>自增</strong> 属性。</li>
<li>自增属性仅适用于<strong>数值类型</strong>的列</li>
<li><code>constraint-name</code> 是我们为约束起的约束名称，方便后续维护和开发</li>
<li><code>data-type</code> 中要写具体的数值类型，例如是 <code>int</code> 还是 <code>bigint</code></li>
</ol>
</blockquote>
<p>&#x3D;&#x3D;2.外键约束&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>约束类型</th>
<th>关键字</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>外键约束</strong><br></td>
<td><code>FOREIGN KEY</code><br></td>
<td>让两张表的列中数据之间产生连接<br></td>
</tr>
</tbody></table>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> 添加外键约束<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> &lt;<span class="hljs-keyword">constraint</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">foreign key</span> (&lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt;) <span class="hljs-keyword">references</span> &lt;referenced-<span class="hljs-keyword">table</span>&gt; (&lt;referenced-<span class="hljs-keyword">column</span>&gt;) [<span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> 更新行为] [<span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> 删除行为];<br><br><br># <span class="hljs-number">2.</span> 删除外键约束<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">drop</span> <span class="hljs-keyword">foreign key</span> &lt;<span class="hljs-keyword">constraint</span>-<span class="hljs-type">name</span>&gt;;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>不必完全写出表名的所有字符，可以用缩写或简写，但要保证能辨识。<br>例如，<code>client_authentication_methods</code> 可缩写为 <code>cam</code>，<code>client_id</code> 保留完整或简写为 <code>client_id</code>。<br>fk_表名_字段_to_关联表_字段</li>
</ol>
</blockquote>
<p>&#x3D;&#x3D;3.普通约束&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th><strong>约束类型</strong></th>
<th><strong>关键字</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>唯一约束</strong></td>
<td><code>UNIQUE</code></td>
<td>用于确保列中的值<strong>在表中是唯一</strong>的，允许 <code>NULL</code> 值。</td>
</tr>
<tr>
<td><strong>检查约束</strong></td>
<td><code>CHECK</code></td>
<td>用于确保列中的值满足特定的条件或表达式。在 MySQL 8.0 及以上版本支持。</td>
</tr>
<tr>
<td><strong>非空约束</strong></td>
<td><code>NOT NULL</code></td>
<td>用于确保列中的值不能为 <code>NULL</code>。</td>
</tr>
<tr>
<td><strong>默认值约束</strong></td>
<td><code>DEFAULT</code></td>
<td>用于为列设置默认值，如果插入数据时没有指定该列的值，数据库将自动使用默认值。</td>
</tr>
</tbody></table>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> 唯一约束（☆☆☆）<br># <span class="hljs-number">1.1</span>. 添加唯一约束<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> &lt;<span class="hljs-keyword">constraint</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">unique</span> (&lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt;);<br><br># <span class="hljs-number">1.2</span>. 删除唯一约束<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">drop</span> <span class="hljs-keyword">index</span> &lt;<span class="hljs-keyword">constraint</span>-<span class="hljs-type">name</span>&gt;;<br>`uk_clients_client_id` —— clients 表的 client_id 字段唯一约束。<br><br><br><br># <span class="hljs-number">2.</span> 检查约束<br># <span class="hljs-number">2.1</span>. 添加检查约束<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> &lt;<span class="hljs-keyword">constraint</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">check</span> (&lt;condition&gt;);<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> &lt;<span class="hljs-keyword">constraint</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">check</span> (&lt;column1-<span class="hljs-type">name</span>&gt; &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> &lt;column2-<span class="hljs-type">name</span>&gt; &lt; <span class="hljs-number">100</span>);<br><br># <span class="hljs-number">2.2</span>. 删除检查约束<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; <span class="hljs-keyword">drop</span> <span class="hljs-keyword">check</span> &lt;<span class="hljs-keyword">constraint</span>-<span class="hljs-type">name</span>&gt;;<br><br><br># <span class="hljs-number">3.</span> 非空约束<br># <span class="hljs-number">3.1</span>. 添加非空约束<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; modify &lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt; &lt;data-<span class="hljs-keyword">type</span>&gt; <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>;<br><br># <span class="hljs-number">3.2</span>. 删除非空约束<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt;modify &lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt; &lt;data-<span class="hljs-keyword">type</span>&gt; <span class="hljs-keyword">null</span>;<br><br><br># <span class="hljs-number">4.</span> 默认值约束<br># <span class="hljs-number">4.1</span>. 添加默认值约束<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; modify &lt;<span class="hljs-built_in">column_name</span>&gt; &lt;data_type&gt; <span class="hljs-keyword">default</span> &lt;default_value&gt;;<br><br># <span class="hljs-number">4.2</span>. 删除默认值约束<br>allter <span class="hljs-keyword">table</span> &lt;<span class="hljs-keyword">table</span>-<span class="hljs-type">name</span>&gt; modify &lt;<span class="hljs-keyword">column</span>-<span class="hljs-type">name</span>&gt; &lt;data_type&gt;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>特别注意 <strong>唯一约束</strong>，因为唯一约束会自动创建 <strong>唯一索引</strong>，因此命令稍有不同。其他三种约束命令上差异不大。</li>
<li>要修改约束，我们先删除旧约束，再添加新约束</li>
</ol>
</blockquote>
<hr>
<h4 id="7-3-补充：外键约束"><a href="#7-3-补充：外键约束" class="headerlink" title="7.3. 补充：外键约束"></a>7.3. 补充：外键约束</h4><h5 id="7-3-1-外键约束建立原则"><a href="#7-3-1-外键约束建立原则" class="headerlink" title="7.3.1. 外键约束建立原则"></a>7.3.1. 外键约束建立原则</h5><p>外键约束<strong>定义在从表</strong>中，用于<strong>引用主表的主键或唯一键</strong>。</p>
<hr>
<h5 id="7-3-2-一对一关系"><a href="#7-3-2-一对一关系" class="headerlink" title="7.3.2. 一对一关系"></a>7.3.2. 一对一关系</h5><p>在一对一关系中，两个表中的每一行记录都与另一个表中的一行记录相关联。例如，一个员工对应一个工作证，每个工作证对应一个员工。</p>
<p>在一对一关系中，通常选择<strong>列较少的表作为主表</strong>，<strong>列较多的表作为从表</strong>，并在主表上建立外键。</p>
<p>以 <code>Employee</code> 表和 <code>WorkCard</code> 表为例，<code>Employee</code> 表中的每个员工都有一个唯一的 <code>EmpID</code>，而 <code>WorkCard</code> 表中的每个工作证都对应一个唯一的员工。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> Employee 表（主表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Employee (<br>    EmpID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    <span class="hljs-type">Name</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>)<br>);<br><br><br># <span class="hljs-number">2.</span> WorkCard 表（从表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> WorkCard (<br>    CardID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    EmpID <span class="hljs-type">INT</span>, // 从表的外键字段 -&gt; 主表的字段（一般命名相同）<br>    IssueDate <span class="hljs-type">DATE</span>,<br>    <span class="hljs-keyword">FOREIGN KEY</span> (EmpID) <span class="hljs-keyword">REFERENCES</span> Employee(EmpID)<br>);<br></code></pre></td></tr></table></figure>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521211043750.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521211108505.png" srcset="/img/loading.gif" lazyload></p>
<blockquote>
<p>[!NOTE] 注意事项：</p>
<ol>
<li>删除数据时，先删除从表数据，再删除主表数据</li>
<li>插入数据时，先插入主表数据，再插入从表</li>
</ol>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> 先插入 Employee 表（主表）数据<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> Employee (EmpID, <span class="hljs-type">Name</span>) <br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;John Doe&#x27;</span>);<br><br><br># <span class="hljs-number">2.</span> 再插入 WorkCard 表（从表）数据<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> WorkCard (CardID, EmpID, IssueDate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">101</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2025-04-09&#x27;</span>);<br></code></pre></td></tr></table></figure>

<hr>
<h5 id="7-3-3-一对多"><a href="#7-3-3-一对多" class="headerlink" title="7.3.3. 一对多"></a>7.3.3. 一对多</h5><p>在一对多关系中，一个表中的一行记录可以与另一个表中的多行记录相关联。常见的例子是：一个部门有多个员工（多），而每个员工只能属于一个部门（一）。</p>
<p>在一对多关系总，选择 <strong>“一”的表作为主表</strong>，<strong>“多”的表作为从表</strong></p>
<p>假设有 <code>Department</code>（部门表）和 <code>Employee</code>（员工表）。一个部门有多个员工，每个员工属于一个部门。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> Department 表（主表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Department (<br>    DeptID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    DeptName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>)<br>);<br><br><br># <span class="hljs-number">2.</span> Employee 表（从表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Employee (<br>    EmpID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    <span class="hljs-type">Name</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>    DeptID <span class="hljs-type">INT</span>,<br>    <span class="hljs-keyword">FOREIGN KEY</span> (DeptID) <span class="hljs-keyword">REFERENCES</span> Department(DeptID)<br>);<br></code></pre></td></tr></table></figure>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521212132677.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250521212154361.png" srcset="/img/loading.gif" lazyload></p>
<blockquote>
<p>[!NOTE] 注意事项：</p>
<ol>
<li>删除数据时，先删除从表数据，再删除主表数据</li>
<li>插入数据时，先插入主表数据，再插入从表</li>
</ol>
</blockquote>
<hr>
<h5 id="7-3-4-多对多"><a href="#7-3-4-多对多" class="headerlink" title="7.3.4. 多对多"></a>7.3.4. 多对多</h5><p>在多对多关系中，表中的多行记录与另一个表中的多行记录相互关联。常见的例子是：一个学生可以选修多门课程（多），每门课程也可以有多个学生选修（多）。</p>
<p>在多对多关系中，我们通常需要 <strong>一个中间表</strong> 来存储关联信息。<strong>在这个中间表中</strong>，我们为每一对关联的表<strong>添加外键</strong>。</p>
<p>假设有 <code>Student</code>（学生表）和 <code>Course</code>（课程表），一个学生可以选修多门课程，而每门课程可以有多个学生选修。我们需要一个中间表 <code>Enrollment</code> 来记录学生与课程之间的关系。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> Student 表（主表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Student (<br>    StudentID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    <span class="hljs-type">Name</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>)<br>);<br><br><br># <span class="hljs-number">2.</span> Course 表（主表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Course (<br>    CourseID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span>,<br>    CourseName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>)<br>);<br><br><br># <span class="hljs-number">3.</span> Enrollment 表（从表）<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Enrollment (<br>    StudentID <span class="hljs-type">INT</span>,<br>    CourseID <span class="hljs-type">INT</span>,<br>    <span class="hljs-keyword">PRIMARY KEY</span> (StudentID, CourseID),<br>    <span class="hljs-keyword">FOREIGN KEY</span> (StudentID) <span class="hljs-keyword">REFERENCES</span> Student(StudentID),<br>    <span class="hljs-keyword">FOREIGN KEY</span> (CourseID) <span class="hljs-keyword">REFERENCES</span> Course(CourseID)<br>);<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>据库设计推荐在这种“纯粹中间表”里省略 id 字段，因为我们PRIMARY KEY (StudentID, CourseID),作为<strong>联合主键</strong>，这已经能唯一标识每一行数据了。</li>
<li>删除数据时，先删除从表数据，再删除主表数据（先删除中间表数据）</li>
<li>插入数据时，先插入主表数据，再插入从表（先左再右后中间）</li>
<li>需要插三次，先左再右后中间</li>
</ol>
</blockquote>
<hr>
<h5 id="7-3-5-外键约束下的删除与更新行为"><a href="#7-3-5-外键约束下的删除与更新行为" class="headerlink" title="7.3.5. 外键约束下的删除与更新行为"></a>7.3.5. 外键约束下的删除与更新行为</h5><table>
<thead>
<tr>
<th><strong>行为</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>CASCADE</strong></td>
<td>如果主表中的数据被删除或更新，外键表中的相关数据会被自动删除或更新。</td>
</tr>
<tr>
<td><strong>SET NULL</strong></td>
<td>如果主表中的数据被删除或更新，外键表中相关数据的外键列会被设置为 <code>NULL</code>。</td>
</tr>
<tr>
<td><strong>NO ACTION</strong></td>
<td>如果主表中的数据被删除或更新，外键约束会阻止该操作发生。如果外键表中存在与主表相关的数据，则不能执行删除或更新操作。</td>
</tr>
<tr>
<td><strong>RESTRICT</strong></td>
<td>与 <code>NO ACTION</code> 类似，阻止删除或更新操作。如果外键表中有相关数据，删除或更新会被拒绝。</td>
</tr>
<tr>
<td><strong>SET DEFAULT</strong></td>
<td>如果主表中的数据被删除或更新，外键表中的相关外键列会被设置为该列的默认值（需要列定义默认值）。</td>
</tr>
</tbody></table>
<hr>
<h3 id="8-MySQL-索引"><a href="#8-MySQL-索引" class="headerlink" title="8. MySQL 索引"></a>8. MySQL 索引</h3><h4 id="8-1-索引存储形式"><a href="#8-1-索引存储形式" class="headerlink" title="8.1. 索引存储形式"></a>8.1. 索引存储形式</h4><p>在 <code>InnoDB</code> 存储引擎中，根据索引的存储形式，可以分为聚集索引和二级索引：</p>
<ol>
<li>&#x3D;&#x3D;聚集索引&#x3D;&#x3D;：<br> 1.一个表中<strong>只能有且必须有一个</strong>聚集索引。<ol>
<li>聚集索引将数据和索引存储在一起，索引结构的叶子节点直接保存行数据</li>
<li>聚集索引的选取规则：<ol>
<li>如果存在<strong>主键索引</strong>，主键索引即为聚集索引</li>
<li>如果没有主键索引，第一个<strong>唯一索引</strong>会作为聚集索引</li>
<li>如果既没有主键也没有唯一索引，<code>InnoDB</code> 会自动为表生成一个<strong>隐藏</strong>的 <code>rowid</code> 作为聚集索引</li>
</ol>
</li>
</ol>
</li>
<li>&#x3D;&#x3D;二级索引&#x3D;&#x3D;：<ol>
<li>一个表中可以存在多个二级索引</li>
<li>二级索引将数据和索引分开存储，索引结构的叶子节点存储的是对应主键的值。</li>
<li>在 <code>InnoDB</code> 存储引擎中，当你查询二级索引列的数据时，过程如下：<ol>
<li>查询会首先通过二级索引查找该列的值，并返回二级索引中的存储的主键值</li>
<li>得到主键值后，查询会使用主键值回到聚集索引中查找实际的数据行。</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250409183911323.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250409192001892.png" srcset="/img/loading.gif" lazyload></p>
<hr>
<h4 id="8-2-索引的分类"><a href="#8-2-索引的分类" class="headerlink" title="8.2. 索引的分类"></a>8.2. 索引的分类</h4><table>
<thead>
<tr>
<th><strong>索引类型</strong></th>
<th><strong>关键字</strong></th>
<th><strong>描述</strong></th>
<th><strong>应用场景</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>主键索引</strong></td>
<td><code>PRIMARY KEY</code></td>
<td>每个表只能有一个主键索引，主键列不允许有 NULL 值。</td>
<td>用于唯一标识表中的每一行，通常是表的主键（例如，<code>id</code> 列）。</td>
</tr>
<tr>
<td><strong>唯一索引</strong></td>
<td><code>UNIQUE</code></td>
<td>保证索引列的值是唯一的，但可以有 NULL 值。</td>
<td>用于确保数据的唯一性，适用于需要保持唯一性的字段（如邮箱地址、用户名等）。</td>
</tr>
<tr>
<td><strong>普通索引</strong></td>
<td><code>INDEX</code> 或 <code>KEY</code></td>
<td>普通索引是最基本的索引类型，不保证值唯一。</td>
<td>用于提高查询速度，适用于不要求唯一性但需要快速查找的字段。</td>
</tr>
<tr>
<td><strong>全文索引</strong></td>
<td><code>FULLTEXT</code></td>
<td>用于全文搜索，通常在 <code>TEXT</code> 类型的列上使用，支持单词的查找。</td>
<td>用于执行全文搜索，如在文章或评论内容中查找关键词。（直接上手 ElasticSearch）</td>
</tr>
<tr>
<td><strong>复合索引</strong></td>
<td><code>INDEX</code> 或 <code>KEY</code></td>
<td>由多个列组成的索引。</td>
<td>当查询涉及多个字段时，可以使用复合索引来提高查询性能，避免多个单列索引的使用。</td>
</tr>
</tbody></table>
<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>一列可以同时有多个不同类型的索引（例如普通索引 + 唯一索引 + 全文索引），但不能有多个相同类型的索引（如两个唯一索引）。</li>
</ol>
</blockquote>
<hr>
<h4 id="8-3-索引相关命令"><a href="#8-3-索引相关命令" class="headerlink" title="8.3. 索引相关命令"></a>8.3. 索引相关命令</h4><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs pf"><span class="hljs-comment"># 1. 添加索引</span><br><span class="hljs-comment"># 1.1. 主键索引</span><br>通过创建主键约束来自动生成主键索引。<br><br><span class="hljs-comment"># 1.2. 唯一索引</span><br>create unique index <span class="hljs-variable">&lt;index-name&gt;</span> <span class="hljs-keyword">on</span> <span class="hljs-variable">&lt;table-name&gt;</span> (<span class="hljs-variable">&lt;column-name&gt;</span>);<br><br><span class="hljs-comment"># 1.3. 普通索引</span><br>create index <span class="hljs-variable">&lt;index-name&gt;</span> <span class="hljs-keyword">on</span> <span class="hljs-variable">&lt;table-name&gt;</span> (<span class="hljs-variable">&lt;column-name&gt;</span>);<br><br><span class="hljs-comment"># 1.4. 全文索引</span><br>create fulltext index <span class="hljs-variable">&lt;index-name&gt;</span> <span class="hljs-keyword">on</span> <span class="hljs-variable">&lt;table-name&gt;</span> (<span class="hljs-variable">&lt;column-name&gt;</span>);<br><br><span class="hljs-comment"># 1.5. 复合索引</span><br>create index <span class="hljs-variable">&lt;index-name&gt;</span> <span class="hljs-keyword">on</span> <span class="hljs-variable">&lt;table-name&gt;</span> (<span class="hljs-variable">&lt;column1&gt;</span>, <span class="hljs-variable">&lt;column2&gt;</span>, ...);<br><br><br><span class="hljs-comment"># 2. 删除索引</span><br><span class="hljs-keyword">drop</span> index <span class="hljs-variable">&lt;index-name&gt;</span> <span class="hljs-keyword">on</span> <span class="hljs-variable">&lt;table-name&gt;</span>;<br><br><br><span class="hljs-comment"># 3. 查询索引</span><br>show index <span class="hljs-keyword">from</span> <span class="hljs-variable">&lt;table-name&gt;</span>;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li><code>&lt;index-name&gt;</code> 是为索引自定义的名称，主要用于后续的维护、查看和删除操作</li>
<li>唯一索引和唯一约束效果相同，只是语义上的差异：<ul>
<li><font color="#00b0f0">唯一索引</font>：<ul>
<li>更偏向结构设计的“规范性”</li>
</ul>
</li>
<li><font color="#00b0f0">唯一约束</font>：<ul>
<li>更偏向数据库“性能调优”的语义表达</li>
</ul>
</li>
</ul>
</li>
</ol>
</blockquote>
<hr>
<h3 id="9-MySQL-视图"><a href="#9-MySQL-视图" class="headerlink" title="9. MySQL 视图"></a>9. MySQL 视图</h3><h4 id="9-1-视图概述"><a href="#9-1-视图概述" class="headerlink" title="9.1. 视图概述"></a>9.1. 视图概述</h4><p>视图是一个虚拟的表，它<strong>内部定义了 SQL 查询语句</strong>，每次你查询视图时，数据库会执行视图中的查询，并动态生成结果，你可以理解为，视图是将一个 SQL 查询的结果作为一个虚拟表进行保存。视图允许用户在不直接访问底层表的情况下，通过查询视图来获取数据。</p>
<p>简单来说，视图充当了数据的抽象层，提供了一个接口，使得客户端可以直接查询视图，而无需关心底层表的结构。可以将查询路径理解为：客户端 -&gt; 视图 -&gt; 表。使用视图的好处有很多：</p>
<ol>
<li>&#x3D;&#x3D;提高数据安全&#x3D;&#x3D;：<ol>
<li>视图可以限制客户端对某些敏感数据的访问。例如，如果你有一个包含用户个人信息的表，你可以创建一个不包含敏感信息（如密码、身份证号等）的视图，来对外提供查询。</li>
<li>作为客户端开发者，你自然不需要限制自己的访问权限，但如果需要简化查询逻辑，视图仍然是一个方便的工具</li>
<li>但是在多用户环境下，你可以通过视图限制用户仅访问他们有权限查看的数据，确保敏感信息的安全</li>
</ol>
</li>
<li>&#x3D;&#x3D;简化查询逻辑&#x3D;&#x3D;：<ol>
<li>假设有一个复杂的查询，涉及多个表、连接、筛选和排序操作。你可以将这些操作封装成一个视图，之后只需查询视图，避免每次都编写复杂的 SQL 查询。<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> 复杂的查询逻辑<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> employee_summary <span class="hljs-keyword">AS</span><br><span class="hljs-keyword">SELECT</span> emp.id, emp.name, dep.name <span class="hljs-keyword">AS</span> department, COUNT(proj.id) <span class="hljs-keyword">AS</span> project_count<br><span class="hljs-keyword">FROM</span> employees emp<br><span class="hljs-keyword">JOIN</span> departments dep <span class="hljs-keyword">ON</span> emp.department_id = dep.id<br><span class="hljs-keyword">LEFT JOIN</span> projects proj <span class="hljs-keyword">ON</span> emp.id = proj.employee_id<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> emp.id;<br><br><br># <span class="hljs-number">2.</span> 直接查询视图<br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employee_summary <span class="hljs-keyword">WHERE</span> department = <span class="hljs-string">&#x27;IT&#x27;</span>;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>在某些特定情况下，<strong>视图可以进行更新</strong>（即可以通过视图执行 <code>INSERT</code>、<code>UPDATE</code> 或 <code>DELETE</code> 操作），但通常情况下，视图<strong>主要用于查询</strong>，<strong>不建议用于数据更新操作</strong></li>
</ol>
</blockquote>
<hr>
<h4 id="9-2-视图相关命令"><a href="#9-2-视图相关命令" class="headerlink" title="9.2. 视图相关命令"></a>9.2. 视图相关命令</h4><p>如果需要修改视图的定义，可以使用 <code>CREATE OR REPLACE VIEW</code> 来替换已有的视图。注意，<code>REPLACE</code> 会删除旧视图并创建新的视图。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"># <span class="hljs-number">1.</span> 创建视图<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">view</span> [if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span>] <span class="hljs-operator">&lt;</span><span class="hljs-keyword">view</span><span class="hljs-operator">-</span>name<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">&lt;</span>column1<span class="hljs-operator">&gt;</span>, <span class="hljs-operator">&lt;</span>column2<span class="hljs-operator">&gt;</span>, ... <span class="hljs-keyword">from</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">table</span><span class="hljs-operator">-</span>name<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">where</span> <span class="hljs-keyword">condition</span><span class="hljs-operator">&gt;</span>;<br><br><br># <span class="hljs-number">2.</span> 删除视图<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">view</span> [if <span class="hljs-keyword">exists</span>] <span class="hljs-operator">&lt;</span><span class="hljs-keyword">view</span><span class="hljs-operator">-</span>name<span class="hljs-operator">&gt;</span>;<br><br><br># <span class="hljs-number">3.</span> 更新视图（相当于重新写了一个视图，会删除旧视图，新建新视图）<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">view</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">view</span><span class="hljs-operator">-</span>name<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">new</span><span class="hljs-operator">-</span>column1<span class="hljs-operator">&gt;</span>,<span class="hljs-operator">&lt;</span><span class="hljs-keyword">new</span><span class="hljs-operator">-</span>column2<span class="hljs-operator">&gt;</span>, ... <span class="hljs-keyword">from</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">table</span><span class="hljs-operator">-</span>name<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">&lt;</span>your<span class="hljs-operator">-</span><span class="hljs-keyword">new</span><span class="hljs-operator">-</span>ondition<span class="hljs-operator">&gt;</span>;<br><br><br># <span class="hljs-number">4.</span> 查询视图（正常怎么查询，这里怎么查询）<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> view_name;<br></code></pre></td></tr></table></figure>

<hr>
<h3 id="10-MySQL-锁"><a href="#10-MySQL-锁" class="headerlink" title="10. MySQL 锁"></a>10. MySQL 锁</h3><hr>
<h3 id="11-MySQL-调优"><a href="#11-MySQL-调优" class="headerlink" title="11. MySQL 调优"></a>11. MySQL 调优</h3><h4 id="11-1-SQL-执行频率"><a href="#11-1-SQL-执行频率" class="headerlink" title="11.1. SQL 执行频率"></a>11.1. SQL 执行频率</h4><p>通过分析 SQL 执行的比例，我们可以判断数据库或表的主要操作类型是查询（SELECT）还是增删改（INSERT、UPDATE、DELETE）。如果主要是查询操作，我们可以重点进行索引优化，以提升查询性能。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-number">1.</span> 查看全局数据<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">global</span> status <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;com%&#x27;</span>;<br><br><br># <span class="hljs-number">2.</span> 查看当前会话数据<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">session</span> status <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;com%&#x27;</span>;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>给出的 <code>value</code> 是次数，<code>value</code> 多大就代表有多少次</li>
</ol>
</blockquote>
<hr>
<h4 id="11-2-慢查询日志"><a href="#11-2-慢查询日志" class="headerlink" title="11.2. 慢查询日志"></a>11.2. 慢查询日志</h4><p>慢日志记录了所有执行时间超过指定参数（<code>long_query_time</code>，单位：秒，默认10秒）的所有SQL语句的日志。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 1. 查看慢日志是否开启</span><br>show variables like <span class="hljs-string">&#x27;slow_query_log&#x27;</span>;<br><br><br><span class="hljs-comment"># 2. 开启慢日志</span><br><span class="hljs-comment"># 2.1. 编辑配置文件</span><br>vim <span class="hljs-regexp">/data/my</span>sql<span class="hljs-regexp">/etc/my</span>sql<span class="hljs-regexp">/conf.d/my</span>.cnf                       <span class="hljs-comment"># 卷挂载</span><br><br><span class="hljs-comment"># 2.2. 添加以下内容</span><br>[mysqld]                                                      <span class="hljs-comment"># mysql 区块</span><br>slow_query_log = <span class="hljs-number">1</span>                                            <span class="hljs-comment"># 开启慢日志</span><br>long_query_time = <span class="hljs-number">0.2</span>                                         <span class="hljs-comment"># 设置慢日志的阈值（单位：秒）</span><br>slow_query_log_file = <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/mysql/my</span>sql-slow.log           <span class="hljs-comment"># 设置慢日志的保存路径</span><br>log_queries_not_using_indexes = <span class="hljs-number">1</span>                             <span class="hljs-comment"># 把所有没有使用索引的 SQL 查询也记录到慢查询日志中，即使它们没超过 long_query_time 阈值</span><br><br><br><span class="hljs-comment"># 3. 重启容器</span><br>docker restart &lt;container-name&gt; / &lt;container-id&gt;<br><br><br><span class="hljs-comment"># 4. 查询慢日志</span><br>cat <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/mysql/</span>localhost-slow.log<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>只要你是在 <code>conf.d</code>、<code>mysql.conf.d</code>、或者自定义的 <code>.cnf</code> 文件里配置，请务必写上 <code>[mysqld]</code></li>
<li>开启慢查询日志后，当你执行 SQL 语句时，如果查询执行时间超过设定的阈值，MySQL 会自动记录该查询为慢查询，并且会立即提醒：</li>
</ol>
</blockquote>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250409223121020.png" srcset="/img/loading.gif" lazyload></p>
<hr>
<h4 id="11-3-Profile-查看详情"><a href="#11-3-Profile-查看详情" class="headerlink" title="11.3. Profile 查看详情"></a>11.3. Profile 查看详情</h4><p>Profiles 可以帮助我们分析时间的分配，明确哪些环节消耗了最多的时间。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># 1. 查看 MySQL 是否支持 Profile</span><br>select @@have_profiling;<br><br><br><span class="hljs-comment"># 2. 开启 Profile</span><br><span class="hljs-keyword">set</span> profiling = <span class="hljs-number">1</span>;<br><br><br><span class="hljs-comment"># 3. 执行一系列 SQL 语句</span><br>select * <span class="hljs-keyword">from</span> <span class="hljs-built_in">characters</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>;<br>select * <span class="hljs-keyword">from</span> <span class="hljs-built_in">characters</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-number">2</span>;<br>select * <span class="hljs-keyword">from</span> <span class="hljs-built_in">characters</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">id</span>=<span class="hljs-number">3</span>;<br><br><br><span class="hljs-comment"># 4. 查看 SQL 语句耗时时间</span><br>show profiles;<br><br><br><span class="hljs-comment"># 5. 根据 query-id 查看 SQL 语句每个阶段的耗时情况</span><br>show profile <span class="hljs-keyword">for</span> query &lt;query-<span class="hljs-built_in">id</span>&gt;;<br><br><br><span class="hljs-comment"># 6. 根据 query-id 查看 SQL 语句 CPU 使用情况</span><br>show profile cpu <span class="hljs-keyword">for</span> query &lt;query-<span class="hljs-built_in">id</span>&gt;;<br></code></pre></td></tr></table></figure>

<hr>
<h4 id="11-4-Explain"><a href="#11-4-Explain" class="headerlink" title="11.4. Explain"></a>11.4. Explain</h4><p><code>explain</code> 命令用于获取 mysql 执行 <code>select</code> 语句的执行计划信息，包括表如何连接、连接顺序等细节。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">explain</span> &lt;<span class="hljs-keyword">select</span> 语句&gt;<br></code></pre></td></tr></table></figure>
<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410100653127.png" srcset="/img/loading.gif" lazyload></p>
<ol>
<li>&#x3D;&#x3D;id&#x3D;&#x3D;:<ol>
<li>查询的 <strong>标识符</strong>，它表示在多表查询中每个操作的执行顺序。例如，<code>id = 1</code> 是最先执行的操作，<code>id = 2</code> 是第二个执行的操作，依此类推。</li>
<li>在单表查询中，<code>id</code> 始终为 <code>1</code>。</li>
<li>在多表查询中，<code>id</code> 会被分配一个递增的数字，用来标识查询的执行顺序。</li>
</ol>
</li>
<li>&#x3D;&#x3D;select_type&#x3D;&#x3D;：<ol>
<li>查询的类型</li>
<li><font color="#00b0f0">SIMPLE</font>：<ol>
<li>简单的查询，没有使用子查询或联合查询。</li>
</ol>
</li>
<li><font color="#00b0f0">PRIMAR</font>：<ol>
<li>表示主查询（最外层查询），如果查询中有子查询，主查询会标记为 <code>PRIMARY</code>。</li>
</ol>
</li>
<li><font color="#00b0f0">SUBQUER</font>：<ol>
<li>表示子查询。</li>
</ol>
</li>
<li><font color="#00b0f0">DEPENDENT SUBQUER</font>：<ol>
<li>依赖于外部查询的子查询。</li>
</ol>
</li>
<li><font color="#00b0f0">UNION</font>：<ol>
<li>表示 <code>UNION</code> 查询中的第二个查询。</li>
</ol>
</li>
</ol>
</li>
<li>&#x3D;&#x3D;table&#x3D;&#x3D;：<ol>
<li>查询的 <strong>表</strong>，表示该行对应的操作是针对哪张表进行的。</li>
</ol>
</li>
<li>&#x3D;&#x3D;partitions&#x3D;&#x3D;：<ol>
<li>查询操作作用的 <strong>分区</strong>。</li>
<li>在使用分区表时，表示该查询在哪些分区上执行。</li>
<li>没有分区的表，这一列会显示为 <code>NULL</code>。</li>
</ol>
</li>
<li>&#x3D;&#x3D;type&#x3D;&#x3D;：<ol>
<li>连接类型，表示 MySQL 查询优化器选择的访问方式。一下是性能由差到好的顺序：</li>
<li><font color="#00b0f0">all</font>：<ol>
<li>全表扫描，表示 MySQL 会扫描表中的所有记录，效率较低。</li>
</ol>
</li>
<li><font color="#00b0f0">index</font>：<ol>
<li>索引扫描，表示 MySQL 会扫描整个索引而不是整个表。</li>
</ol>
</li>
<li><font color="#00b0f0">range</font>：<ol>
<li>范围扫描，表示 MySQL 会使用索引查找某个范围的记录。</li>
</ol>
</li>
<li><font color="#00b0f0">ref</font>：<ol>
<li>基于非唯一索引的扫描。</li>
</ol>
</li>
<li><font color="#00b0f0">eq_ref</font>：<ol>
<li>基于唯一索引的扫描，每个记录都能对应唯一的索引值。</li>
</ol>
</li>
<li><font color="#00b0f0">const</font>：<ol>
<li>常量查找，表示表中的每一行记录都可以通过常量来匹配，效率非常高。</li>
</ol>
</li>
<li><font color="#00b0f0">system</font>：<ol>
<li>表示系统表，通常表示只有一行数据的表（如数据库的 <code>information_schema</code> 表）。</li>
</ol>
</li>
</ol>
</li>
<li>&#x3D;&#x3D;possible_keys&#x3D;&#x3D;：<ol>
<li>本次查询可能使用到的索引，如果没有使用索引，则为 null</li>
</ol>
</li>
<li>&#x3D;&#x3D;key&#x3D;&#x3D;：<ol>
<li>实际使用的 <strong>索引</strong>，表示查询中实际使用的索引。</li>
<li>如果该字段显示为 <code>NULL</code>，表示没有使用索引，可能进行了全表扫描</li>
<li>如果显示了索引名，表示优化器选择了这个索引来执行查询</li>
</ol>
</li>
<li>&#x3D;&#x3D;key_len&#x3D;&#x3D;：<ol>
<li>表示优化器使用的索引的 <strong>长度</strong>（单位：字节）。该值通常与索引列的类型和数量相关。</li>
<li>在不损失精确性的前提下， 长度越短越好 。</li>
</ol>
</li>
<li>&#x3D;&#x3D;ref&#x3D;&#x3D;：<ol>
<li><strong>索引列的比较值</strong>，显示该查询使用了哪个字段（或常量）来与索引中的值进行比较。</li>
</ol>
</li>
<li>&#x3D;&#x3D;rows&#x3D;&#x3D;：<ol>
<li>估计 <strong>需要扫描的行数</strong>，表示查询执行时，优化器估算的需要扫描的表中记录的数量。</li>
</ol>
</li>
<li>&#x3D;&#x3D;filtered&#x3D;&#x3D;：<ol>
<li>表示返回结果的行数占需读取行数的百分比， filtered 的值越大越好。</li>
</ol>
</li>
<li>&#x3D;&#x3D;Extra&#x3D;&#x3D;：<ol>
<li>提供有关查询执行的额外信息</li>
</ol>
</li>
</ol>
<h1 id="二、实操（搭建-MySQL）"><a href="#二、实操（搭建-MySQL）" class="headerlink" title="二、实操（搭建 MySQL）"></a>二、实操（搭建 MySQL）</h1><h3 id="1-环境搭建"><a href="#1-环境搭建" class="headerlink" title="1. 环境搭建"></a>1. 环境搭建</h3><h4 id="1-1-单机测试环境搭建"><a href="#1-1-单机测试环境搭建" class="headerlink" title="1.1. 单机测试环境搭建"></a>1.1. 单机测试环境搭建</h4><p>&#x3D;&#x3D;1.创建宿主机数据挂载目录&#x3D;&#x3D;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /mystudy/data/mysql<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;2.启动 MySQL 容器&#x3D;&#x3D;</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -d <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  --name my_mysql <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  -p <span class="hljs-number">3306</span>:<span class="hljs-number">3306</span> <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  -e MYSQL_ROOT_PASSWORD=wq666666 <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  -v /mystudy/data/mysql:/var/lib/mysql <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  mysql:<span class="hljs-number">8</span>.<span class="hljs-number">0</span> <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  --character-set-server=utf8mb4 <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  --collation-server=utf8mb4_unicode_ci<br></code></pre></td></tr></table></figure>

<hr>
<h3 id="分布式集群环境搭建"><a href="#分布式集群环境搭建" class="headerlink" title="分布式集群环境搭建"></a>分布式集群环境搭建</h3><h3 id="2-高可用集群（非-K8S）"><a href="#2-高可用集群（非-K8S）" class="headerlink" title="2. 高可用集群（非 K8S）"></a>2. 高可用集群（非 K8S）</h3><hr>
<h3 id="3-高可以集群（K8S）"><a href="#3-高可以集群（K8S）" class="headerlink" title="3. 高可以集群（K8S）"></a>3. 高可以集群（K8S）</h3><h1 id="三、工具"><a href="#三、工具" class="headerlink" title="三、工具"></a>三、工具</h1><h3 id="1-MyCat2"><a href="#1-MyCat2" class="headerlink" title="1. MyCat2"></a>1. MyCat2</h3><hr>
<h3 id="2-Java-Faker"><a href="#2-Java-Faker" class="headerlink" title="2. Java Faker"></a>2. Java Faker</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.javafaker<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javafaker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.github.javafaker.Faker;<br><br><span class="hljs-keyword">import</span> java.util.Locale;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FakerDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 创建 Faker 实例，设置为中文（zh-CN）</span><br>        <span class="hljs-type">Faker</span> <span class="hljs-variable">faker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Faker</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Locale</span>(<span class="hljs-string">&quot;zh-CN&quot;</span>));<br><br>        <span class="hljs-comment">// 基本信息</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> faker.name().fullName();        <span class="hljs-comment">// 中文全名</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">email</span> <span class="hljs-operator">=</span> faker.internet().emailAddress();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> faker.phoneNumber().cellPhone();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">address</span> <span class="hljs-operator">=</span> faker.address().fullAddress();<br><br>        <span class="hljs-comment">// 职业、公司、行业</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">job</span> <span class="hljs-operator">=</span> faker.job().title();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">company</span> <span class="hljs-operator">=</span> faker.company().name();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">industry</span> <span class="hljs-operator">=</span> faker.company().industry();<br><br>        <span class="hljs-comment">// 黑客/技术术语（需要英文环境）</span><br>        <span class="hljs-type">Faker</span> <span class="hljs-variable">enFaker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Faker</span>();  <span class="hljs-comment">// 默认英文</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">techPhrase</span> <span class="hljs-operator">=</span> enFaker.hacker().phrase();<br><br>        <span class="hljs-comment">// 输出</span><br>        System.out.println(<span class="hljs-string">&quot;👤 姓名：&quot;</span> + name);<br>        System.out.println(<span class="hljs-string">&quot;📧 邮箱：&quot;</span> + email);<br>        System.out.println(<span class="hljs-string">&quot;📞 手机：&quot;</span> + phone);<br>        System.out.println(<span class="hljs-string">&quot;🏠 地址：&quot;</span> + address);<br>        System.out.println(<span class="hljs-string">&quot;💼 职位：&quot;</span> + job);<br>        System.out.println(<span class="hljs-string">&quot;🏢 公司：&quot;</span> + company);<br>        System.out.println(<span class="hljs-string">&quot;🏭 行业：&quot;</span> + industry);<br>        System.out.println(<span class="hljs-string">&quot;💻 黑客术语：&quot;</span> + techPhrase);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<table>
<thead>
<tr>
<th>模块</th>
<th>方法</th>
<th>示例内容</th>
</tr>
</thead>
<tbody><tr>
<td><code>name()</code></td>
<td><code>.fullName()</code></td>
<td>张伟、李娜</td>
</tr>
<tr>
<td><code>internet()</code></td>
<td><code>.emailAddress()</code></td>
<td><a href="mailto:abc123@example.com">abc123@example.com</a></td>
</tr>
<tr>
<td><code>phoneNumber()</code></td>
<td><code>.cellPhone()</code></td>
<td>139-8888-7777</td>
</tr>
<tr>
<td><code>address()</code></td>
<td><code>.fullAddress()</code></td>
<td>北京市朝阳区某路100号</td>
</tr>
<tr>
<td><code>job()</code></td>
<td><code>.title()</code></td>
<td>数据工程师、UI设计师</td>
</tr>
<tr>
<td><code>company()</code></td>
<td><code>.name()</code> <code>.industry()</code></td>
<td>腾讯、人工智能行业</td>
</tr>
<tr>
<td><code>hacker()</code></td>
<td><code>.verb()</code> <code>.noun()</code> <code>.phrase()</code></td>
<td>bypass the firewall…</td>
</tr>
<tr>
<td><code>lorem()</code></td>
<td><code>.paragraph()</code></td>
<td>模拟一段看起来有逻辑的文本</td>
</tr>
</tbody></table>
<h3 id="3-DataGrip"><a href="#3-DataGrip" class="headerlink" title="3. DataGrip"></a>3. DataGrip</h3><h4 id="3-1-汉化"><a href="#3-1-汉化" class="headerlink" title="3.1. 汉化"></a>3.1. 汉化</h4><p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250519144517641.png" srcset="/img/loading.gif" lazyload></p>
<hr>
<h1 id="二、实操"><a href="#二、实操" class="headerlink" title="二、实操"></a>二、实操</h1><h3 id="1-安装-MyCat2"><a href="#1-安装-MyCat2" class="headerlink" title="1. 安装 MyCat2"></a>1. 安装 MyCat2</h3><p>&#x3D;&#x3D;1.安装 JDK&#x3D;&#x3D;<br>使用MyCAT 2要安装JDK，因为MyCAT 是基于JDK1.8开发的</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> apt install openjdk-<span class="hljs-number">17</span>-jdk<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;2.创建存放 MyCat 的目录&#x3D;&#x3D;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. 常见 /tools</span><br><span class="hljs-built_in">mkdir</span> -p /tools<br><br><br><span class="hljs-comment"># 2. 进入 /tools</span><br><span class="hljs-built_in">cd</span> /tools<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;3.将 MyCat2 相关包拖过来&#x3D;&#x3D;<br>将 <code>mycat2-install-template-1.21.zip</code> 和 <code>mycat2-1.22-release-jar-with-dependencies.jar</code> 拖到 <code>/tools</code> 目录下</p>
<p>&#x3D;&#x3D;4.解压 MyCat2 安装包&#x3D;&#x3D;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. 安装 unzip 工具（需要解压 .zip 包）</span><br><span class="hljs-built_in">sudo</span> apt install unzip<br><br><br><span class="hljs-comment"># 2. 解压 MyCat2 安装包</span><br>unzip mycat2-install-template-1.21.zip<br><br><br><span class="hljs-comment"># 3. 增加对 /tools/mycat/bin 的执行权限</span><br><span class="hljs-built_in">cd</span> /tools/mycat/bin<br><br><span class="hljs-built_in">chmod</span> +x *<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;5.复制 jar 包到 &#x2F;tools&#x2F;mycat&#x2F;lib 目录&#x3D;&#x3D;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> /tools/mycat2-1.22-release-jar-with-dependencies.jar /tools/mycat/lib<br></code></pre></td></tr></table></figure>





<p>绕过 Linux 的用户名和密码，直接使用 MyCat2 的用户名和密码进行登录<br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250523113818549.png" srcset="/img/loading.gif" lazyload></p>
<p>启动有问题看日志：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">cat /tools/mycat/logs/<span class="hljs-keyword">wrapper</span>.<span class="hljs-keyword">log</span><br></code></pre></td></tr></table></figure>

<hr>
<h3 id="2-安全管理"><a href="#2-安全管理" class="headerlink" title="2. 安全管理"></a>2. 安全管理</h3><h1 id="三、补充"><a href="#三、补充" class="headerlink" title="三、补充"></a>三、补充</h1><h3 id="1-MyCat2-的目录结构"><a href="#1-MyCat2-的目录结构" class="headerlink" title="1. MyCat2 的目录结构"></a>1. MyCat2 的目录结构</h3><h4 id="1-1-目录总览"><a href="#1-1-目录总览" class="headerlink" title="1.1. 目录总览"></a>1.1. 目录总览</h4><p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMyCat2/image-20250406155610051.png" srcset="/img/loading.gif" lazyload></p>
<ol>
<li>&#x3D;&#x3D;bin&#x3D;&#x3D;：<ol>
<li>执行主要命令的目录</li>
</ol>
</li>
<li>&#x3D;&#x3D;conf&#x3D;&#x3D;：<ol>
<li>软件的配置文件</li>
</ol>
</li>
<li>&#x3D;&#x3D;lib&#x3D;&#x3D;：<ol>
<li>该软件的依赖包</li>
</ol>
</li>
<li>&#x3D;&#x3D;logs&#x3D;&#x3D;：<ol>
<li>该软件的日志包</li>
</ol>
</li>
</ol>
<hr>
<h1 id="四、补充"><a href="#四、补充" class="headerlink" title="四、补充"></a>四、补充</h1><h3 id="1-相关网站"><a href="#1-相关网站" class="headerlink" title="1. 相关网站"></a>1. 相关网站</h3><ol>
<li>MyCat2 官方网站：<ol>
<li><a target="_blank" rel="noopener" href="http://mycatone.top/">http://mycatone.top/</a></li>
</ol>
</li>
</ol>
<h3 id="2-MySQL-目录结构"><a href="#2-MySQL-目录结构" class="headerlink" title="2. MySQL 目录结构"></a>2. MySQL 目录结构</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">根目录 /<br>|<span class="hljs-string"></span><br><span class="hljs-string"></span>|<span class="hljs-string">-- var /</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<br>|<span class="hljs-string">   </span>|<span class="hljs-string">-- lib /</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<br>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- mysql /                               # 默认的数据目录       </span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">       </span>|<br>|<span class="hljs-string">   </span>|<span class="hljs-string">       </span>|<span class="hljs-string">-- ibdata1                           # InnoDB 的共享表空间</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">       </span>|<br>|<span class="hljs-string">   </span>|<span class="hljs-string">       </span>|<span class="hljs-string">-- mysql /                           # 存放 MySQL 用户、权限、时区等系统信息</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">       </span>|<br>|<span class="hljs-string">   </span>|<span class="hljs-string">       </span>|<span class="hljs-string">-- yout_database_name /              # 你的库数据和相关信息，一个库一个目录</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<br>|<span class="hljs-string">   </span>|<span class="hljs-string">-- log /                                     # 存放日志（错误日志、慢查询日志等）</span><br><span class="hljs-string"></span>|<br>|<span class="hljs-string">-- etc /</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<br>|<span class="hljs-string">   </span>|<span class="hljs-string">-- my.cnf                                    # 全局配置文件，定义 MySQL 基础参数</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<br>|<span class="hljs-string">   </span>|<span class="hljs-string">-- my.cnf.d /                                # 存放独立配置文件，可以覆盖或扩展主配置</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string"> </span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- mysql /</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<br>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- conf.d /                              # 存放独立配置文件，可以覆盖或扩展配置文件</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项：配置文件的优先级</p>
<ol>
<li><code>/etc/my.cnf.d/*.cnf</code> &gt; <code>/etc/mysql/conf.d/*.cnf</code> &gt; <code>my.cnf</code></li>
</ol>
</blockquote>
<hr>
<h3 id="3-常用数据类型"><a href="#3-常用数据类型" class="headerlink" title="3. 常用数据类型"></a>3. 常用数据类型</h3><p>&#x3D;&#x3D;1.数值类型&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>字节数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>TINYINT</code></td>
<td>1</td>
<td>很小的整数，范围：有符号 <code>-128~127</code>，无符号 <code>0~255</code></td>
</tr>
<tr>
<td><code>SMALLINT</code></td>
<td>2</td>
<td>小整数，有符号 <code>-32,768~32,767</code>，无符号 <code>0~65,535</code></td>
</tr>
<tr>
<td><code>MEDIUMINT</code></td>
<td>3</td>
<td>中等整数，有符号 <code>-8,388,608~8,388,607</code>，无符号 <code>0~16,777,215</code></td>
</tr>
<tr>
<td><code>INT</code> 或 <code>INTEGER</code></td>
<td>4</td>
<td>标准整数，有符号 <code>-2^31~2^31-1</code>，无符号 <code>0~2^32-1</code></td>
</tr>
<tr>
<td><code>BIGINT</code></td>
<td>8</td>
<td>大整数，有符号 <code>-2^63~2^63-1</code>，无符号 <code>0~2^64-1</code></td>
</tr>
<tr>
<td><code>FLOAT(M,D)</code></td>
<td>4</td>
<td>单精度浮点数，M 是总位数，D 是小数位数（精度约为 7 位十进制）</td>
</tr>
<tr>
<td><code>DOUBLE(M,D)</code> 或 <code>REAL</code></td>
<td>8</td>
<td>双精度浮点数（精度约为 15 位十进制）</td>
</tr>
<tr>
<td><code>DECIMAL(M,D)</code> 或 <code>NUMERIC(M,D)</code></td>
<td>变长</td>
<td>精确小数，不丢失精度，M 是总位数，D 是小数位（用于金融等）</td>
</tr>
</tbody></table>
<p>&#x3D;&#x3D;2.字符串类型&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>字节数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>CHAR(n)</code></td>
<td>固定 n 字节（1 ≤ n ≤ 255）</td>
<td>固定长度字符串，不足部分补空格，适合长度一致的数据</td>
</tr>
<tr>
<td><code>VARCHAR(n)</code></td>
<td>实际长度 + 1&#x2F;2 字节</td>
<td>可变长度字符串，n ≤ 65,535（受行大小和字符集影响）</td>
</tr>
<tr>
<td><code>TEXT</code></td>
<td>最大 65,535 字节（64KB）</td>
<td>大文本字段，不可创建索引（除非指定长度）</td>
</tr>
<tr>
<td><code>TINYTEXT</code></td>
<td>最大 255 字节</td>
<td>小文本字段</td>
</tr>
<tr>
<td><code>MEDIUMTEXT</code></td>
<td>最大 16,777,215 字节（16MB）</td>
<td>中文本字段</td>
</tr>
<tr>
<td><code>LONGTEXT</code></td>
<td>最大 4,294,967,295 字节（4GB）</td>
<td>大文本字段</td>
</tr>
<tr>
<td><code>BINARY(n)</code></td>
<td>固定长度二进制数据</td>
<td>类似 CHAR，但存储二进制数据</td>
</tr>
<tr>
<td><code>VARBINARY(n)</code></td>
<td>可变长度二进制数据</td>
<td>类似 VARCHAR，但存储二进制数据</td>
</tr>
<tr>
<td><code>BLOB</code></td>
<td>二进制大对象，最大 64KB</td>
<td>用于存储二进制数据，如图片、音频</td>
</tr>
<tr>
<td><code>TINYBLOB</code></td>
<td>最大 255 字节</td>
<td>小二进制对象</td>
</tr>
<tr>
<td><code>MEDIUMBLOB</code></td>
<td>最大 16MB</td>
<td>中等大小二进制对象</td>
</tr>
<tr>
<td><code>LONGBLOB</code></td>
<td>最大 4GB</td>
<td>超大二进制对象</td>
</tr>
<tr>
<td><code>ENUM</code></td>
<td>1 或 2 字节</td>
<td>枚举类型，取值需从预设的字符串中选（如 <code>&#39;male&#39;, &#39;female&#39;</code>）</td>
</tr>
<tr>
<td><code>SET</code></td>
<td>1~8 字节</td>
<td>多选枚举（可同时选多个值）</td>
</tr>
</tbody></table>
<p>&#x3D;&#x3D;3.时间和日期类型&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>字节数</th>
<th>描述</th>
<th>格式示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>DATE</code></td>
<td>3</td>
<td>仅日期，范围：<code>1000-01-01 ~ 9999-12-31</code></td>
<td><code>&#39;YYYY-MM-DD&#39;</code> → <code>2025-04-09</code></td>
</tr>
<tr>
<td><code>TIME</code></td>
<td>3</td>
<td>仅时间，范围：<code>-838:59:59 ~ 838:59:59</code></td>
<td><code>&#39;HH:MM:SS&#39;</code> → <code>14:23:59</code></td>
</tr>
<tr>
<td><code>DATETIME</code></td>
<td>8</td>
<td>日期 + 时间，范围：<code>1000-01-01 00:00:00</code> ~ <code>9999-12-31 23:59:59</code></td>
<td><code>&#39;YYYY-MM-DD HH:MM:SS&#39;</code> → <code>2025-04-09 14:23:59</code></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
<td>4</td>
<td>UNIX 时间戳（UTC），1970年起的秒数，可自动更新时间</td>
<td><code>&#39;YYYY-MM-DD HH:MM:SS&#39;</code> → <code>2025-04-09 06:23:59</code></td>
</tr>
<tr>
<td><code>YEAR</code></td>
<td>1</td>
<td>表示年份，范围：<code>1901 ~ 2155</code></td>
<td><code>&#39;YYYY&#39;</code> → <code>2025</code></td>
</tr>
</tbody></table>
<blockquote>
<p>[!NOTE] 注意事项： <code>DATETIME</code> 和 <code>TIMESTAMP</code> 的区别</p>
<ol>
<li><font color="#00b0f0">DATETIME</font>：<ul>
<li>纯时间点，存储和时区无关</li>
</ul>
</li>
<li><font color="#00b0f0">TIMESTAMP</font><ul>
<li>是时间戳，会受服务器时区影响（适合记录变动时间）</li>
</ul>
</li>
</ol>
</blockquote>
<hr>
<h3 id="4-常用运算符"><a href="#4-常用运算符" class="headerlink" title="4. 常用运算符"></a>4. 常用运算符</h3><p>&#x3D;&#x3D;1.比较运算符&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>比较运算符</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>&gt;</td>
<td>大于</td>
<td>SELECT * FROM Employees WHERE Salary &gt; 50000;</td>
</tr>
<tr>
<td>&gt;&#x3D;</td>
<td>大于等于</td>
<td>SELECT * FROM Employees WHERE Age &gt;&#x3D; 30;</td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
<td>SELECT * FROM Products WHERE Price &lt; 100;</td>
</tr>
<tr>
<td>&lt;&#x3D;</td>
<td>小于等于</td>
<td>SELECT * FROM Students WHERE Marks &lt;&#x3D; 75;</td>
</tr>
<tr>
<td>&#x3D;</td>
<td>等于</td>
<td>SELECT * FROM Customers WHERE Country &#x3D; ‘USA’;</td>
</tr>
<tr>
<td>&lt;&gt; 或 !&#x3D;</td>
<td>不等于</td>
<td>SELECT * FROM Orders WHERE Status &lt;&gt; ‘Shipped’; SELECT * FROM Orders WHERE Status !&#x3D; ‘Shipped’;</td>
</tr>
<tr>
<td>BETWEEN … AND …</td>
<td>在某个范围之内（含最小、最大值）</td>
<td>SELECT * FROM Sales WHERE Date BETWEEN ‘2022-01-01’ AND ‘2022-12-31’;</td>
</tr>
<tr>
<td>IN(…)</td>
<td>在 in 之后的列表中的值，多选一</td>
<td>SELECT * FROM Employees WHERE Department IN (‘Sales’, ‘HR’, ‘IT’);</td>
</tr>
<tr>
<td>LIKE 占位符</td>
<td>模糊匹配（_匹配单个字符，%匹配任意多个字符）</td>
<td>SELECT * FROM Customers WHERE Name LIKE ‘A%’;</td>
</tr>
<tr>
<td>IS NULL</td>
<td>是 NULL</td>
<td>SELECT * FROM Employees WHERE ManagerID IS NULL;</td>
</tr>
</tbody></table>
<p>&#x3D;&#x3D;2.逻辑运算符&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>逻辑运算符</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>AND 或 &amp;&amp;</td>
<td>并且（多个条件同时成立）</td>
<td>SELECT * FROM Employees WHERE Age &gt; 25 AND Department &#x3D; ‘IT’;</td>
</tr>
<tr>
<td>OR 或 |</td>
<td>或者（多个条件任意一个成立）</td>
<td>SELECT * FROM Products WHERE Price &lt; 50 OR Stock &gt; 100;</td>
</tr>
<tr>
<td>NOT 或 !</td>
<td>非，不是</td>
<td>SELECT * FROM Customers WHERE NOT Country &#x3D; ‘USA’;</td>
</tr>
</tbody></table>
<hr>
<h3 id="5-常用函数"><a href="#5-常用函数" class="headerlink" title="5. 常用函数"></a>5. 常用函数</h3><p>&#x3D;&#x3D;1.聚合函数&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>count</td>
<td>统计数量</td>
<td>SELECT COUNT(*) AS total_rows FROM employees; – 结果：返回employees表中行的总数</td>
</tr>
<tr>
<td>max</td>
<td>最大值</td>
<td>SELECT MAX(salary) AS max_salary FROM employees; – 结果：返回employees表中salary列的最大值</td>
</tr>
<tr>
<td>min</td>
<td>最小值</td>
<td>SELECT MIN(salary) AS min_salary FROM employees; – 结果：返回employees表中salary列的最小值</td>
</tr>
<tr>
<td>avg</td>
<td>平均值</td>
<td>SELECT AVG(salary) AS avg_salary FROM employees; – 结果：返回employees表中salary列的平均值</td>
</tr>
<tr>
<td>sum</td>
<td>求和</td>
<td>SELECT SUM(salary) AS total_salary FROM employees; – 结果：返回employees表中salary列的总和</td>
</tr>
</tbody></table>
<p>&#x3D;&#x3D;2.日期函数&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>CURDATE()</td>
<td>返回当前日期</td>
<td>SELECT CURDATE() AS current_date; – 结果：例如 ‘2023-10-10’ （根据执行日期不同会有不同的结果）</td>
</tr>
<tr>
<td>CURTIME()</td>
<td>返回当前时间</td>
<td>SELECT CURTIME() AS current_time; – 结果：例如 ‘14:30:45’ （根据执行时间不同会有不同的结果）</td>
</tr>
<tr>
<td>NOW()</td>
<td>返回当前日期和时间</td>
<td>SELECT NOW() AS current_date_time; – 结果：例如 ‘2023-10-10 14:30:45’ （根据执行日期和时间不同会有不同的结果）</td>
</tr>
<tr>
<td>YEAR(date)</td>
<td>获取date中的年份</td>
<td>SELECT YEAR(‘2023-10-10’) AS year; – 结果：2023</td>
</tr>
<tr>
<td>MONTH(date)</td>
<td>获取date中的月份</td>
<td>SELECT MONTH(‘2023-10-10’) AS month; – 结果：10</td>
</tr>
<tr>
<td>DAY(date)</td>
<td>获取date中的日期</td>
<td>SELECT DAY(‘2023-10-10’) AS day; – 结果：10</td>
</tr>
<tr>
<td>DATE_ADD(date, INTERVAL expr type)</td>
<td>返回一个日期&#x2F;时间值，expr参数加在指定的日期值得到新的日期</td>
<td>SELECT DATE_ADD(‘2023-10-10’, INTERVAL 5 DAY) AS new_date; – 结果：’2023-10-15’</td>
</tr>
<tr>
<td>DATEDIFF(expr1, expr2)</td>
<td>返回起始时间expr1与结束时间expr2之间的天数</td>
<td>SELECT DATEDIFF(‘2023-10-15’, ‘2023-10-10’) AS diff_days; – 结果：5</td>
</tr>
<tr>
<td>CURRENT_TIMESTAMP</td>
<td>返回当前的时间，格式是 YYYY-MM-DD HH:MM:SS</td>
<td></td>
</tr>
</tbody></table>
<p>你这个格式非常清晰，下面我就照你这套格式，补充一些 <strong>常用的 MySQL 日期时间函数</strong>，非常实用：</p>
<hr>
<table>
<thead>
<tr>
<th>函数&#x2F;表达式名</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>CURRENT_TIMESTAMP</code></td>
<td>返回当前的时间，格式是 <code>YYYY-MM-DD HH:MM:SS</code></td>
<td><code>SELECT CURRENT_TIMESTAMP;</code> → <code>2025-05-19 17:45:00</code></td>
</tr>
<tr>
<td><code>NOW()</code></td>
<td>返回当前时间，等价于 <code>CURRENT_TIMESTAMP</code></td>
<td><code>SELECT NOW();</code> → <code>2025-05-19 17:45:00</code></td>
</tr>
<tr>
<td><code>CURDATE()</code></td>
<td>返回当前日期，格式是 <code>YYYY-MM-DD</code></td>
<td><code>SELECT CURDATE();</code> → <code>2025-05-19</code></td>
</tr>
<tr>
<td><code>CURTIME()</code></td>
<td>返回当前时间（不含日期），格式是 <code>HH:MM:SS</code></td>
<td><code>SELECT CURTIME();</code> → <code>17:45:00</code></td>
</tr>
<tr>
<td><code>UNIX_TIMESTAMP()</code></td>
<td>返回当前的 Unix 时间戳（秒数）</td>
<td><code>SELECT UNIX_TIMESTAMP();</code> → <code>1747647900</code></td>
</tr>
<tr>
<td><code>FROM_UNIXTIME(unix_timestamp)</code></td>
<td>将 Unix 时间戳转换为可读时间格式</td>
<td><code>SELECT FROM_UNIXTIME(1747647900);</code> → <code>2025-05-19 17:45:00</code></td>
</tr>
<tr>
<td><code>DATEDIFF(date1, date2)</code></td>
<td>返回两个日期相差的“天数”（date1 - date2）</td>
<td><code>SELECT DATEDIFF(&#39;2023-10-15&#39;, &#39;2023-10-10&#39;);</code> → <code>5</code></td>
</tr>
<tr>
<td><code>TIMEDIFF(time1, time2)</code></td>
<td>返回两个时间之间的差值（格式是 HH:MM:SS）</td>
<td><code>SELECT TIMEDIFF(&#39;10:30:00&#39;, &#39;08:00:00&#39;);</code> → <code>02:30:00</code></td>
</tr>
<tr>
<td><code>DATE_ADD(date, INTERVAL n unit)</code></td>
<td>在日期上加时间间隔</td>
<td><code>SELECT DATE_ADD(&#39;2025-05-19&#39;, INTERVAL 5 DAY);</code> → <code>2025-05-24</code></td>
</tr>
<tr>
<td><code>DATE_SUB(date, INTERVAL n unit)</code></td>
<td>在日期上减时间间隔</td>
<td><code>SELECT DATE_SUB(&#39;2025-05-19&#39;, INTERVAL 7 DAY);</code> → <code>2025-05-12</code></td>
</tr>
<tr>
<td><code>YEAR(date)</code></td>
<td>提取年份</td>
<td><code>SELECT YEAR(&#39;2025-05-19&#39;);</code> → <code>2025</code></td>
</tr>
<tr>
<td><code>MONTH(date)</code></td>
<td>提取月份</td>
<td><code>SELECT MONTH(&#39;2025-05-19&#39;);</code> → <code>5</code></td>
</tr>
<tr>
<td><code>DAY(date)</code> 或 <code>DAYOFMONTH(date)</code></td>
<td>提取日（几号）</td>
<td><code>SELECT DAY(&#39;2025-05-19&#39;);</code> → <code>19</code></td>
</tr>
<tr>
<td><code>HOUR(datetime)</code></td>
<td>提取小时数</td>
<td><code>SELECT HOUR(&#39;2025-05-19 17:45:00&#39;);</code> → <code>17</code></td>
</tr>
<tr>
<td><code>MINUTE(datetime)</code></td>
<td>提取分钟数</td>
<td><code>SELECT MINUTE(&#39;2025-05-19 17:45:00&#39;);</code> → <code>45</code></td>
</tr>
</tbody></table>
<hr>
<p>需要我单独为你做一张“开发中常用时间函数速查表”PDF或 Markdown 表格版本吗？可以贴在项目文档里当工具书用 😎</p>
<p>&#x3D;&#x3D;3.流程函数&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>IF(value, a, b)</td>
<td>如果value为true，则返回a；否则返回b</td>
</tr>
<tr>
<td>IFNULL(a, b)</td>
<td>如果a不为空，则返回a；否则返回b</td>
</tr>
<tr>
<td>CASE WHEN [value] THEN […] [ELSE …] END</td>
<td>也是条件语句</td>
</tr>
</tbody></table>
<p>&#x3D;&#x3D;4.数字函数&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>CEIL(x)</td>
<td>向上取整</td>
<td>SELECT CEIL(4.2) AS ceil_value; – 结果：5 SELECT CEIL(-4.2) AS ceil_value; – 结果：-4</td>
</tr>
<tr>
<td>FLOOR(x)</td>
<td>向下取整</td>
<td>SELECT FLOOR(4.8) AS floor_value; – 结果：4 SELECT FLOOR(-4.8) AS floor_value; – 结果：-5</td>
</tr>
<tr>
<td>MOD(x, y)</td>
<td>返回x &#x2F; y的模</td>
<td>SELECT MOD(10, 3) AS mod_value; – 结果：1 SELECT MOD(10, 5) AS mod_value; – 结果：0</td>
</tr>
<tr>
<td>RAND()</td>
<td>返回0～1内的随机数</td>
<td>SELECT RAND() AS random_value; – 结果：例如：0.123456789</td>
</tr>
<tr>
<td>ROUND(x, y)</td>
<td>求取参数x的四舍五入值，保留小数点后y位</td>
<td>SELECT id, ROUND(number, 2) AS rounded_value FROM numbers;</td>
</tr>
</tbody></table>
<p>&#x3D;&#x3D;5.字符串函数&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>CONCAT(s1, s2, …, sn)</td>
<td>字符串连接，将s1, s2,…,sn几个字符串连接成一个字符串</td>
<td>SELECT LOWER(‘HeLLo WoRLd’) AS result; – 结果：’hello world’</td>
</tr>
<tr>
<td>LOWER(str)</td>
<td>返回字符串str的全小写字母</td>
<td>SELECT LOWER(‘HeLLo WoRLd’) AS result; – 结果：’hello world’</td>
</tr>
<tr>
<td>UPPER(str)</td>
<td>返回字符串str的全大写字母</td>
<td>SELECT UPPER(‘HeLLo WoRLd’) AS result; – 结果：’HELLO WORLD’</td>
</tr>
<tr>
<td>LTRIM(str)</td>
<td>返回字符串str去除左边空格的结果</td>
<td>SELECT LTRIM(‘ Hello World’) AS result; – 结果：’Hello World’</td>
</tr>
<tr>
<td>RTRIM(str)</td>
<td>返回字符串str去除右边空格的结果</td>
<td>SELECT RTRIM(‘Hello World ‘) AS result; – 结果：’Hello World’</td>
</tr>
<tr>
<td>TRIM(str)</td>
<td>返回字符串str去除前导和尾随空格的结果</td>
<td>SELECT TRIM(‘ Hello World ‘) AS result; – 结果：’Hello World’</td>
</tr>
<tr>
<td>SUBSTRING(str, pos, len)</td>
<td>返回字符串str从pos开始len个字符的字符串</td>
<td>SELECT SUBSTRING(‘Hello World’, 7, 5) AS result; – 结果：’World’</td>
</tr>
<tr>
<td>REPLACE(str, a, b)</td>
<td>返回字符串str，将其中的字符串a全部替换为字符串b</td>
<td>SELECT REPLACE(‘Hello World’, ‘World’, ‘MySQL’) AS result; – 结果：’Hello MySQL’</td>
</tr>
<tr>
<td>LPAD(str, len, pad)</td>
<td>返回字符串str从左边填充pad字符后，到len长度的结果</td>
<td>SELECT LPAD(‘Hello’, 10, ‘-‘) AS result; – 结果：’—–Hello’</td>
</tr>
<tr>
<td>RPAD(str, len, pad)</td>
<td>返回字符串str从右边填充pad字符后，到len长度的结果</td>
<td>SELECT RPAD(‘Hello’, 10, ‘-‘) AS result; – 结果：’Hello—–’</td>
</tr>
</tbody></table>
<hr>
<h3 id="6-常见存储引擎"><a href="#6-常见存储引擎" class="headerlink" title="6. 常见存储引擎"></a>6. 常见存储引擎</h3><table>
<thead>
<tr>
<th><strong>引擎</strong></th>
<th><strong>特点</strong></th>
<th><strong>适合场景</strong></th>
<th>当前状况</th>
</tr>
</thead>
<tbody><tr>
<td><strong>InnoDB（默认）</strong></td>
<td>支持事务、行级锁、外键约束、ACID 特性，性能优良。</td>
<td>高并发、事务性应用、需要保证数据一致性、支持外键约束的场景（例如在线交易系统、金融应用）</td>
<td>MySQL 默认引擎，功能强大，适合大多数场景，强烈推荐使用 InnoDB。</td>
</tr>
<tr>
<td><strong>MyISAM</strong></td>
<td>不支持事务和外键，支持表级锁，读性能高，写性能较差。</td>
<td>以读操作为主的场景，如数据仓库、日志分析、静态内容存储等</td>
<td>不推荐使用</td>
</tr>
<tr>
<td><strong>MEMORY</strong></td>
<td>数据存储在内存中，读写速度非常快，但数据会丢失。</td>
<td>临时表、缓存数据、临时存储数据的场景。适用于需要快速存取的临时数据处理（例如会话存储）</td>
<td>直接上手 Redis 它不香吗</td>
</tr>
<tr>
<td><strong>ARCHIVE</strong></td>
<td>高压缩、适合存储大量只读数据。支持 INSERT 但不支持 UPDATE。</td>
<td>存档数据、历史数据存储场景，特别是数据量大且访问频率较低的情况</td>
<td>适合存储历史数据，例如三个月前或三年前的数据，常用于数据归档。</td>
</tr>
<tr>
<td><strong>BLACKHOLE</strong></td>
<td>不存储数据，所有插入操作都被丢弃，读取为空。</td>
<td>数据复制、测试用的空引擎，模拟写入操作而不存储数据</td>
<td>临时测试场景，也不推荐使用</td>
</tr>
</tbody></table>
<hr>
<h3 id="7-SQL-脚本"><a href="#7-SQL-脚本" class="headerlink" title="7. SQL 脚本"></a>7. SQL 脚本</h3><p>SQL 文件（.sql 文件）通常用于存储数据库操作的 SQL 脚本，这些脚本包含各种数据库管理和操作命令。</p>
<p>我们可以手动编写 SQL 脚本，也可以使用工具如 Navicat，将已创建的表和数据库导出为 SQL 文件。通过在其他地方运行该 SQL 文件，我们可以轻松重建之前的表和数据库。SQL 文件不仅可以作为备份使用，还可以共享给他人。</p>
<p>&#x3D;&#x3D;1.导出 SQL 文件&#x3D;&#x3D;<br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410104022257.png" srcset="/img/loading.gif" lazyload></p>
<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>这里将数据库导出为 SQL 文件，包含库、表和数据的创建。</li>
<li>也可以只导出表，运行 SQL 文件时不会创建数据库，而是将在当前数据库中创建表和数据。</li>
</ol>
</blockquote>
<p>&#x3D;&#x3D;2.运行 SQL 文件&#x3D;&#x3D;<br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250410104203864.png" srcset="/img/loading.gif" lazyload></p>
<p>&#x3D;&#x3D;3.SQL 文件示例&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> Navicat Premium Data Transfer</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> Source Server         : 192.168.136.7</span><br><span class="hljs-comment"> Source Server Type    : MySQL</span><br><span class="hljs-comment"> Source Server Version : 80041 (8.0.41)</span><br><span class="hljs-comment"> Source Host           : 192.168.136.7:3306</span><br><span class="hljs-comment"> Source Schema         : test</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> Target Server Type    : MySQL</span><br><span class="hljs-comment"> Target Server Version : 80041 (8.0.41)</span><br><span class="hljs-comment"> File Encoding         : 65001</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> Date: 10/04/2025 10:42:42</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-keyword">SET NAMES</span> utf8mb4;<br><span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="hljs-number">0</span>;<br><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-comment">-- Table structure for characters</span><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> `characters`;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `characters`  (<br>  `id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `<span class="hljs-type">name</span>` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `<span class="hljs-keyword">alias</span>` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `title` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `affiliation` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `power_level` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `description` <span class="hljs-type">text</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">NULL</span>,<br>  `status` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY KEY</span> (`id`) <span class="hljs-keyword">USING</span> BTREE<br>) ENGINE = InnoDB AUTO_INCREMENT = <span class="hljs-number">52</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> = utf8mb4 <span class="hljs-keyword">COLLATE</span> = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC;<br><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-comment">-- Records of characters</span><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `characters` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;姜子牙&#x27;</span>, <span class="hljs-string">&#x27;吕尚&#x27;</span>, <span class="hljs-string">&#x27;太师&#x27;</span>, <span class="hljs-string">&#x27;阐教&#x27;</span>, <span class="hljs-string">&#x27;天尊&#x27;</span>, <span class="hljs-string">&#x27;姜子牙是封神演义中的重要人物，辅佐周武王推翻商朝，封神榜上位列仙班&#x27;</span>, <span class="hljs-string">&#x27;已死&#x27;</span>);<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;4.运行建议&#x3D;&#x3D;<br>有人说 Navicat 运行速度较慢，我们可以考虑使用 SQLyog 进行运行。</p>
<hr>
<h3 id="NULL-值处理"><a href="#NULL-值处理" class="headerlink" title="NULL 值处理"></a>NULL 值处理</h3><ol>
<li>&#x3D;&#x3D;IS NULL&#x3D;&#x3D;：<ol>
<li>当列的值是 NULL,此运算符返回 true。</li>
</ol>
</li>
<li>&#x3D;&#x3D;IS NOT NULL&#x3D;&#x3D;：<ol>
<li>当列的值不为 NULL, 运算符返回 true。</li>
</ol>
</li>
<li>&#x3D;&#x3D;&lt; &#x3D; &gt;&#x3D;&#x3D;：<ol>
<li>比较操作符（不同于 &#x3D; 运算符），当比较的的两个值相等或者都为 NULL 时返回 true。</li>
</ol>
</li>
</ol>
<h1 id="——"><a href="#——" class="headerlink" title="——"></a>——</h1><p>不像redis，不强制读写分离，但推荐</p>
<h3 id="1-MySQL-最佳实践"><a href="#1-MySQL-最佳实践" class="headerlink" title="1. MySQL 最佳实践"></a>1. MySQL 最佳实践</h3><h4 id="1-1-高可用实现"><a href="#1-1-高可用实现" class="headerlink" title="1.1. 高可用实现"></a>1.1. 高可用实现</h4><ol>
<li>&#x3D;&#x3D;主从之间&#x3D;&#x3D;<ol>
<li>MySQL 集群采用主从复制架构</li>
<li>主从复制：</li>
<li>故障转移</li>
<li>主控制从：</li>
<li>实时备灾：</li>
<li>读写分离：</li>
<li>数据备份：</li>
</ol>
</li>
<li>&#x3D;&#x3D;主主之间&#x3D;&#x3D;：<ol>
<li>信息同步：</li>
<li>选举领导：</li>
</ol>
</li>
<li>&#x3D;&#x3D;负载均衡&#x3D;&#x3D;：<ol>
<li>使用 K8S 进行部署</li>
</ol>
</li>
<li>&#x3D;&#x3D;数据存储&#x3D;&#x3D;：<ol>
<li>存储位置：<ol>
<li>首选本地存储，如果使用 K8s 担心主节点迁移，数据丢失，可选择以下方式：</li>
<li>公有云（块存储）</li>
<li>私有云</li>
<li>主节点固定，即使用 nodelector，将 Master 固定在那上面，方式 Master 迁移没数据了，从节点迁移无所调谓，反正又会同步（慢点？）</li>
</ol>
</li>
<li>存储方法：<ol>
<li>MyCat 实现分片（分库分表）</li>
</ol>
</li>
</ol>
</li>
</ol>
<hr>
<h4 id="1-2-架构图"><a href="#1-2-架构图" class="headerlink" title="1.2. 架构图"></a>1.2. 架构图</h4><h4 id="1-3-流程图"><a href="#1-3-流程图" class="headerlink" title="1.3. 流程图"></a>1.3. 流程图</h4><h4 id="1-4-安全规划"><a href="#1-4-安全规划" class="headerlink" title="1.4. 安全规划"></a>1.4. 安全规划</h4><h4 id="1-5-节点规划"><a href="#1-5-节点规划" class="headerlink" title="1.5. 节点规划"></a>1.5. 节点规划</h4><h4 id="1-6-数据存储"><a href="#1-6-数据存储" class="headerlink" title="1.6. 数据存储"></a>1.6. 数据存储</h4><p>首选本地文件存储，如果是使用 K8S 搭建 MySQL 集群，</p>
<h3 id="2-Docker-安装-MySQL"><a href="#2-Docker-安装-MySQL" class="headerlink" title="2. Docker 安装 MySQL"></a>2. Docker 安装 MySQL</h3><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><span class="hljs-title">docker pull mysql:</span>latest<br><br><br><span class="hljs-title">docker run --name mysql-container -e MYSQL_ROOT_PASSWORD=wq666666 -d -p 3306:3306 mysql:</span>latest<br><br><br><span class="hljs-title">docker run --name mysql-container -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:</span>latest<br>- `--name mysql-container`：指定容器的名称为 `mysql-container`。<br>- `-e MYSQL_ROOT_PASSWORD=my-secret-pw`：设置 MySQL 根用户的密码为 `my-secret-pw`。<br>- `-d`：让容器在后台运行。<br><span class="hljs-title">- `mysql:</span>latest`：指定要使用的 MySQL 镜像。<br><br></code></pre></td></tr></table></figure>








<h3 id="3-集群搭建"><a href="#3-集群搭建" class="headerlink" title="3. 集群搭建"></a>3. 集群搭建</h3><p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250406182807697.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="4-一主多从-keepavlied-mycat-MHA"><a href="#4-一主多从-keepavlied-mycat-MHA" class="headerlink" title="4. 一主多从(keepavlied + mycat + MHA"></a>4. 一主多从(keepavlied + mycat + MHA</h3><p>&#x3D;&#x3D;1.MySQL 集群&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>IP</th>
<th>主机名</th>
<th>角色</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.136.8</td>
<td>mysql-master<br></td>
<td>MySQL 主库 + Keepalived 主</td>
</tr>
<tr>
<td>192.168.136.9<br></td>
<td>mysql-slave1</td>
<td>MySQL 从库 + Keepalived 备</td>
</tr>
<tr>
<td>192.168.136.10<br></td>
<td>mysql-slave2</td>
<td>MySQL 从库 + Keepalived 备</td>
</tr>
<tr>
<td>192.168.136.100<br></td>
<td>mysql-vip</td>
<td>绑定在 MySQL 主库上的 VIP</td>
</tr>
</tbody></table>
<p>&#x3D;&#x3D;2.MyCat 集群&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>IP</th>
<th>主机名</th>
<th>角色</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.136.12</td>
<td>mycat1</td>
<td>MyCat 主 + Keepalived 主</td>
</tr>
<tr>
<td>192.168.136.13</td>
<td>mycat2</td>
<td>MyCat 备 + Keepalived 备</td>
</tr>
<tr>
<td>192.168.136.101</td>
<td>mycat-vip</td>
<td>绑定在 MyCat 主上的 VIP</td>
</tr>
</tbody></table>
<p>&#x3D;&#x3D;3.MHA 集群&#x3D;&#x3D;</p>
<table>
<thead>
<tr>
<th>IP</th>
<th>主机名</th>
<th>角色</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.136.16</td>
<td>mha1</td>
<td>MHA 主 + Keepalived 主</td>
</tr>
<tr>
<td>192.168.136.17</td>
<td>mha2</td>
<td>MHA 备 + Keepalived 备</td>
</tr>
<tr>
<td>192.168.136.20</td>
<td>mha-vip</td>
<td>绑定在 MHA 主上的 VIP</td>
</tr>
</tbody></table>
<ol>
<li>MySQL 集群环境搭建<ol>
<li>安装 Docker</li>
<li>安装 Keepalived</li>
</ol>
</li>
<li>MyCAT 集群环境搭建<ol>
<li>安装 MyCat</li>
<li>安装 Keepalived</li>
</ol>
</li>
<li>MHA 集群环境搭建<ol>
<li>安装 MHA</li>
<li>安装 Keepalived</li>
</ol>
</li>
<li>MHA 与 MyCat 和 MySQL ssh互通，无密码</li>
</ol>
<h3 id="5-非-K8S-环境"><a href="#5-非-K8S-环境" class="headerlink" title="5. 非 K8S 环境"></a>5. 非 K8S 环境</h3><h4 id="5-1-一主多从"><a href="#5-1-一主多从" class="headerlink" title="5.1. 一主多从"></a>5.1. 一主多从</h4><h5 id="5-1-1-MySQL-集群节点环境准备"><a href="#5-1-1-MySQL-集群节点环境准备" class="headerlink" title="5.1.1. MySQL 集群节点环境准备"></a>5.1.1. MySQL 集群节点环境准备</h5><table>
<thead>
<tr>
<th>IP</th>
<th>主机名</th>
</tr>
</thead>
<tbody><tr>
<td>136.8</td>
<td>mysql1</td>
</tr>
</tbody></table>
<p>&#x3D;&#x3D;1.修改主机名&#x3D;&#x3D;</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">hostnamectl</span> <span class="hljs-built_in">set-hostname</span> &lt;<span class="hljs-string">host-name</span>&gt;<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;1.安装和配置 Docker&#x3D;&#x3D;</p>
<p>&#x3D;&#x3D;2.安装 Keepalived 和其相关依赖&#x3D;&#x3D;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. 安装 Keepalived 相关依赖</span><br><span class="hljs-built_in">sudo</span> apt install -y conntrack libseccomp2<br><br><br><span class="hljs-comment"># 2. 安装 Keepalived</span><br><span class="hljs-built_in">sudo</span> apt-get install -y keepalived<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;3.创建数据持久化目录&#x3D;&#x3D;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. 模版</span><br><span class="hljs-built_in">mkdir</span> -p /data/mysql/&lt;host-name&gt;/conf /data/mysql/&lt;host-name&gt;/data<br><br><br><span class="hljs-comment"># 2. MySQL 1</span><br><span class="hljs-built_in">mkdir</span> -p /data/mysql/mysql1/conf /data/mysql/mysql1/data<br><br><br><span class="hljs-comment"># 3. MySQL 2</span><br><span class="hljs-built_in">mkdir</span> -p /data/mysql/mysql2/conf /data/mysql/mysql2/data<br><br><br><span class="hljs-comment"># 4. MySQL 3</span><br><span class="hljs-built_in">mkdir</span> -p /data/mysql/mysql3/conf /data/mysql/mysql3/data<br></code></pre></td></tr></table></figure>


<p>&#x3D;&#x3D;4.安装 MySQL&#x3D;&#x3D;</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs livescript">docker run -d <span class="hljs-string">\</span>                             <span class="hljs-comment"># 以“后台模式”运行容器（detached mode）</span><br>  --name &lt;host-name&gt; <span class="hljs-string">\</span>                      <span class="hljs-comment"># 指定容器名称，建议替换 &lt;host-name&gt; 为具体名字，如 mysql-master</span><br>  -p <span class="hljs-number">3306</span>:<span class="hljs-number">3306</span> <span class="hljs-string">\</span>                            <span class="hljs-comment"># 将宿主机的 3306 端口映射到容器的 3306 端口（MySQL 默认端口）</span><br>  -e MYSQL_ROOT_PASSWORD=wq666666 <span class="hljs-string">\</span>        <span class="hljs-comment"># 设置 MySQL root 用户的初始密码</span><br>  -v /data/mysql/master/conf:/etc/mysql/conf.d <span class="hljs-string">\</span>   <span class="hljs-comment"># 挂载配置文件目录（宿主机 -&gt; 容器），方便修改 MySQL 配置</span><br>  -v /data/mysql/master/data:/<span class="hljs-keyword">var</span>/lib/mysql <span class="hljs-string">\</span>      <span class="hljs-comment"># 持久化数据目录，防止容器删除后数据丢失</span><br>  mysql:<span class="hljs-number">8.0</span> <span class="hljs-string">\</span>                               <span class="hljs-comment"># 使用 mysql 官方镜像，版本为 8.0</span><br>  --character-set-server=utf8mb4 <span class="hljs-string">\</span>         <span class="hljs-comment"># 设置 MySQL 服务器默认字符集为 utf8mb4（支持 Emoji 和多语言）</span><br>  --collation-server=utf8mb4_unicode_ci    <span class="hljs-comment"># 设置排序规则为 utf8mb4_unicode_ci，适用于多语言环境</span><br><br><br>docker run -d <span class="hljs-string">\</span><br>  --name &lt;host-name&gt; <span class="hljs-string">\</span><br>  -p <span class="hljs-number">3306</span>:<span class="hljs-number">3306</span> <span class="hljs-string">\</span><br>  -e MYSQL_ROOT_PASSWORD=wq666666 <span class="hljs-string">\</span><br>  -v <span class="hljs-regexp">/data/</span>&lt;host-name&gt;/master/conf:/etc/mysql/conf.d <span class="hljs-string">\</span><br>  -v <span class="hljs-regexp">/data/</span>&lt;host-name&gt;/master/data:/<span class="hljs-keyword">var</span>/lib/mysql <span class="hljs-string">\</span><br>  mysql:<span class="hljs-number">8.0</span> <span class="hljs-string">\</span><br>  --character-set-server=utf8mb4 <span class="hljs-string">\</span><br>  --collation-server=utf8mb4_unicode_ci<br><br><br>docker run -d <span class="hljs-string">\</span><br>  --name mysql1 <span class="hljs-string">\</span><br>  -p <span class="hljs-number">3306</span>:<span class="hljs-number">3306</span> <span class="hljs-string">\</span><br>  -e MYSQL_ROOT_PASSWORD=wq666666 <span class="hljs-string">\</span><br>  -v /data/mysql/mysql1/data:/<span class="hljs-keyword">var</span>/lib/mysql <span class="hljs-string">\</span><br>  mysql:<span class="hljs-number">8.0</span> <span class="hljs-string">\</span><br>  --character-set-server=utf8mb4 <span class="hljs-string">\</span><br>  --collation-server=utf8mb4_unicode_ci<br><br><br>docker run -d <span class="hljs-string">\</span><br>  --name mysql1 <span class="hljs-string">\</span><br>  -p <span class="hljs-number">3306</span>:<span class="hljs-number">3306</span> <span class="hljs-string">\</span><br>  -e MYSQL_ROOT_PASSWORD=wq666666 <span class="hljs-string">\</span><br>  -v /data/mysql/mysql1/conf:/etc/mysql/conf.d <span class="hljs-string">\</span><br>  -v /data/mysql/mysql1/data:/<span class="hljs-keyword">var</span>/lib/mysql <span class="hljs-string">\</span><br>  mysql:<span class="hljs-number">8.0</span> <span class="hljs-string">\</span><br>  --character-set-server=utf8mb4 <span class="hljs-string">\</span><br>  --collation-server=utf8mb4_unicode_ci<br><br><br>docker run -d <span class="hljs-string">\</span><br>  --name mysql2 <span class="hljs-string">\</span><br>  -p <span class="hljs-number">3306</span>:<span class="hljs-number">3306</span> <span class="hljs-string">\</span><br>  -e MYSQL_ROOT_PASSWORD=wq666666 <span class="hljs-string">\</span><br>  -v /data/mysql/mysql2/conf:/etc/mysql/conf.d <span class="hljs-string">\</span><br>  -v /data/mysql/mysql2/data:/<span class="hljs-keyword">var</span>/lib/mysql <span class="hljs-string">\</span><br>  mysql:<span class="hljs-number">8.0</span> <span class="hljs-string">\</span><br>  --character-set-server=utf8mb4 <span class="hljs-string">\</span><br>  --collation-server=utf8mb4_unicode_ci<br><br><br><br>docker run -d <span class="hljs-string">\</span><br>  --name mysql3 <span class="hljs-string">\</span><br>  -p <span class="hljs-number">3306</span>:<span class="hljs-number">3306</span> <span class="hljs-string">\</span><br>  -e MYSQL_ROOT_PASSWORD=wq666666 <span class="hljs-string">\</span><br>  -v /data/mysql/mysql3/conf:/etc/mysql/conf.d <span class="hljs-string">\</span><br>  -v /data/mysql/mysql3/data:/<span class="hljs-keyword">var</span>/lib/mysql <span class="hljs-string">\</span><br>  mysql:<span class="hljs-number">8.0</span> <span class="hljs-string">\</span><br>  --character-set-server=utf8mb4 <span class="hljs-string">\</span><br>  --collation-server=utf8mb4_unicode_ci<br></code></pre></td></tr></table></figure>


<hr>
<h5 id="5-1-2-部署-MySQL-集群"><a href="#5-1-2-部署-MySQL-集群" class="headerlink" title="5.1.2. 部署 MySQL 集群"></a>5.1.2. 部署 MySQL 集群</h5><ol>
<li><p>配置 MySQL 主从</p>
</li>
<li><p>在 MySQL1 上配置<br>1.配主库文件</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs routeros">1. 在 /data/mysql/mysql1/conf 路径下创建 my.cnf<br><br><br>2. 配置这个 cnf # /data/mysql/mysql1/conf/my.cnf<br><br>[mysqld]                  # 表示接下来的配置都是用于 mysqld 服务端的<br><span class="hljs-attribute">server_id</span>=1               # 定义该 MySQL 实例的唯一 ID，用于区分主从之间的服务器，不可重复<br><span class="hljs-attribute">log-bin</span>=mysql-bin         # 启用二进制日志（binlog），并设置文件名前缀为 mysql-bin<br><span class="hljs-attribute">binlog_format</span>=ROW         # 设置 binlog 的格式为 ROW（行模式）<br><span class="hljs-attribute">gtid_mode</span>=ON              # 启用 **GTID（全局事务 ID）复制**。<br><span class="hljs-attribute">enforce_gtid_consistency</span>=ON   # - 启用 **GTID 一致性检查**，防止执行不兼容 GTID 的语句。必须在启用 GTID 模式之前设置为 ON，否则会报错。<br><br><br>[mysqld]<br><span class="hljs-attribute">server_id</span>=1<br><span class="hljs-attribute">log-bin</span>=mysql-bin<br><span class="hljs-attribute">binlog_format</span>=ROW<br><span class="hljs-attribute">gtid_mode</span>=ON<br><span class="hljs-attribute">enforce_gtid_consistency</span>=ON<br><br><br><br>[mysqld]<br><span class="hljs-attribute">server_id</span>=1  # 主库的 server_id 一般设为 1，唯一<br><span class="hljs-attribute">log_bin</span>=mysql-bin  # 启用 binlog 记录，binlog 用于记录主库的所有写操作<br><span class="hljs-attribute">binlog_format</span>=ROW  # 设置为 ROW 格式，保证数据一致性<br><span class="hljs-attribute">gtid_mode</span>=ON  # 启用 GTID 复制，确保事务的一致性<br><span class="hljs-attribute">enforce_gtid_consistency</span>=ON  # 强制 GTID 一致性<br><span class="hljs-attribute">log_slave_updates</span>=ON  # 启用从库写 binlog，防止级联复制中丢失数据<br><span class="hljs-attribute">read_only</span>=0  # 主库是可写的<br><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">1. server_id：</span><br><span class="hljs-string">	1. 唯一标识一个 MySQL 实例，是 MySQL 复制系统中的“身份证”，如果两个节点 server_id 相同，复制就会失败</span><br><span class="hljs-string">	2. 所有参与复制的实例（包括主库和所有从库）必须设置且唯一</span><br><span class="hljs-string">	3. 通常主库设为 1，从库设为 2、3、4</span><br><span class="hljs-string">2. log_bin：</span><br><span class="hljs-string">	1. 开启 binlog（二进制日志）并指定文件前缀。</span><br><span class="hljs-string">	2. mysql-bin 是日志文件前缀，最终文件会像 mysql-bin.000001 这样。</span><br><span class="hljs-string">3. binlog_format：</span><br><span class="hljs-string">	1. 用于设置 binlog 的记录格式，主要影响 DML 语句（如 INSERT、UPDATE、DELETE）的记录方式。可选值包括：</span><br><span class="hljs-string">	2. ROW：</span><br><span class="hljs-string">		1. 记录每一行数据修改前和修改后的值，主从复制时能最大程度地保证数据一致性</span><br><span class="hljs-string">		2. 特别适用于包含触发器、函数、副作用操作的场景，主从一致性最强</span><br><span class="hljs-string">		3. 缺点是 日志体积大（尤其批量更新时），且不记录原始 SQL，调试难度高</span><br><span class="hljs-string">	3. STATEMENT：</span><br><span class="hljs-string">		1. 只记录原始 SQL 语句，不记录执行结果或变更的具体值</span><br><span class="hljs-string">		2. 优点是 体积小、写入快，效率高</span><br><span class="hljs-string">		3. 缺点是依赖主从执行环境一致，若使用 NOW()、UUID() 等非确定性函数，可能导致主从数据不一致</span><br><span class="hljs-string">		4. 比如 NOW() 是获取当前时间，你前后两次调用，虽然 SQL 语句一致，但是值不同。</span><br><span class="hljs-string">	4. MIXED：</span><br><span class="hljs-string">		1. MySQL 会根据 SQL 的内容自动选择 STATEMENT 或 ROW 模式。</span><br><span class="hljs-string">		2. 通常优先使用 STATEMENT，但在检测到不安全语句（如含 UUID() 等非确定性函数）时自动切换为 ROW，兼顾效率与一致性</span><br><span class="hljs-string">	5. 补充：</span><br><span class="hljs-string">		1. 我们常见的约束、索引、视图等操作其实本质上都是 DDL，只是常常未单独列出。</span><br><span class="hljs-string">		2. 不论使用哪种 binlog_format，DDL 和 DCL 操作都会以原始 SQL 语句事件的形式写入 binlog，binlog_format 的设置只影响 DML 语句的记录方式</span><br><span class="hljs-string">4. gtid_mode：</span><br><span class="hljs-string">	1. 是否启用 GTID（全局事务 ID）复制机制，ON 是开启</span><br><span class="hljs-string">	2. GTID 给每一个事务一个全局唯一的 ID，主从间按 ID 进行复制，推荐必开</span><br><span class="hljs-string">	3. 注意事项：</span><br><span class="hljs-string">		1. 启用前数据库中不能有非 GTID 事务，要确保环境干净</span><br><span class="hljs-string">5. enforce_gtid_consistency：</span><br><span class="hljs-string">	1. 是否强制所有事务兼容 GTID，ON 是开启</span><br><span class="hljs-string">6. log_slave_updates：</span><br><span class="hljs-string">	1. 让 “从库” 在执行主库的事务时，也写自己的 binlog，ON 是开启</span><br><span class="hljs-string">	2. 这个选项一般在作为从库时才需要开启，如果实例只是单纯的主库，不同步别人的数据，那就用不上。但如果是双主架构（彼此做 “从库”），或者将来要做故障切换，那就必须打开它了。</span><br><span class="hljs-string">7. read_only：</span><br><span class="hljs-string">	1. 是否只读，可选值：</span><br><span class="hljs-string">	2. 0：读写</span><br><span class="hljs-string">	3. 1：只读</span><br><span class="hljs-string">	4. 注意事项：</span><br><span class="hljs-string">		1. 我们在数据库层面保持 read_only 允许写入，而由 MyCat 统一管理读写分离策略，从而简化故障切换时的配置变更。</span><br><span class="hljs-string">&quot;</span><span class="hljs-string">&quot;&quot;</span><br><br><br>4.重启<br>docker restart &lt;container-id&gt; / &lt;container-name&gt;<br><br></code></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>[!NOTE] 注意事项：<code>binlog_format</code>：</p>
<ol>
<li><code>STATEMENT</code>（语句模式）：记录执行的 SQL 语句；</li>
<li><code>MIXED</code>（混合模式）：智能切换；</li>
<li><code>ROW</code>：记录实际变化的每一行，推荐用于主从复制。精确记录每一行的变更，适用于主从数据一致性要求较高的场景。</li>
<li>gtid？</li>
</ol>
</blockquote>
<p>&#x3D;&#x3D;2.配从库文件&#x3D;&#x3D;</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs routeros">1. 在 /data/mysql/mysql1/conf 路径下创建 my.cnf<br><br><br>2. 配置这个 cnf # /data/mysql/mysql1/conf/my.cnf<br><br>[mysqld]<br><span class="hljs-attribute">server_id</span>=2  # 从库2的唯一标识，主库为1，其他从库可以递增<br><span class="hljs-attribute">relay_log</span>=relay-bin  # 从库的中继日志文件前缀，用于存储主库的操作记录<br><span class="hljs-attribute">read_only</span>=1  # 设置为只读，防止从库接受写入操作<br><span class="hljs-attribute">gtid_mode</span>=ON  # 启用 GTID（全局事务ID）复制模式，保证复制一致性<br><span class="hljs-attribute">enforce_gtid_consistency</span>=ON  # 强制 GTID 一致性，确保只有符合 GTID 规则的事务被执行<br><br><br>[mysqld]<br><span class="hljs-attribute">server_id</span>=2<br><span class="hljs-attribute">relay_log</span>=relay-bin<br><span class="hljs-attribute">gtid_mode</span>=ON<br><span class="hljs-attribute">enforce_gtid_consistency</span>=ON<br><br><br><br>4.重启<br>docker restart &lt;container-id&gt; / &lt;container-name&gt;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>对对对，当 MHA 动态修改只读，和修改旧主为只读，改 log 是relay 还是mysql</li>
<li></li>
<li>虽然mycat已经进行了读写分离，这里还用配置那么严格吗？（不严格，可以不用read_only&#x3D;1配置只读）</li>
</ol>
</blockquote>
<p>&#x3D;&#x3D;3.创建复制用户 repl 用户&#x3D;&#x3D;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">这是mysl命令啊，你要登录mysql客户端，或者用datagrip 和 navicat 来运行命令<br><br><span class="hljs-comment">-- 创建一个用于主从复制的用户 repl，允许任意主机连接</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;repl&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> <br>  IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <br>  <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;wq666666&#x27;</span>;<br><br>repl：用户名<br>%：**允许从任意主机连接**（`%` 是通配符，匹配所有 IP 地址）<br>wq666666：用户密码<br><br><br><br><br><span class="hljs-comment">-- 授权该用户具有复制权限</span><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">REPLICATION</span> SLAVE <span class="hljs-keyword">ON</span> *.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;repl&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><br><br><span class="hljs-comment">-- 刷新权限，使授权立即生效</span><br>FLUSH <span class="hljs-keyword">PRIVILEGES</span>;<br><br></code></pre></td></tr></table></figure>


<p>查看主库二进制位置（后面会用到）</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">SHOW <span class="hljs-keyword">MASTER</span> <span class="hljs-title">STATUS</span>;<br><br></code></pre></td></tr></table></figure>


<p><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250408141545381.png" srcset="/img/loading.gif" lazyload><br>两个从节点可能相同，但是主节点不同，要注意了<br><img src="/source/_posts/%E7%AC%94%E8%AE%B0%EF%BC%9AMySQL%20%E5%9F%BA%E7%A1%80/image-20250408141924184.png" srcset="/img/loading.gif" lazyload></p>
<p>从库执行命令</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs routeros">这是mysql 命令啊<br><br><br>CHANGE MASTER <span class="hljs-keyword">TO</span> <br>  <span class="hljs-attribute">MASTER_HOST</span>=<span class="hljs-string">&#x27;主库 IP 地址&#x27;</span>,  -- 主库的<span class="hljs-built_in"> IP </span>地址，确保从库能够连接到主库<br>  <span class="hljs-attribute">MASTER_USER</span>=<span class="hljs-string">&#x27;repl&#x27;</span>,  -- 用于复制的用户，通常是具有 REPLICATION SLAVE 权限的用户<br>  <span class="hljs-attribute">MASTER_PASSWORD</span>=<span class="hljs-string">&#x27;Repl@2025&#x27;</span>,  -- 复制用户的密码，确保与主库上的复制用户一致<br>  <span class="hljs-attribute">MASTER_LOG_FILE</span>=<span class="hljs-string">&#x27;主库的 binlog 文件名&#x27;</span>,  -- 主库的当前 binlog 文件名，通过 `SHOW MASTER STATUS` 获取<br>  <span class="hljs-attribute">MASTER_LOG_POS</span>=主库的 binlog 位置,  -- 主库的 binlog 位置，通过 `SHOW MASTER STATUS` 获取<br>  <span class="hljs-attribute">MASTER_AUTO_POSITION</span>=1;  -- 启用 GTID 复制模式，自动管理复制位置<br><br><br>CHANGE MASTER <span class="hljs-keyword">TO</span> <br>  <span class="hljs-attribute">MASTER_HOST</span>=<span class="hljs-string">&#x27;主库 IP 地址&#x27;</span>, <br>  <span class="hljs-attribute">MASTER_USER</span>=<span class="hljs-string">&#x27;repl&#x27;</span>, <br>  <span class="hljs-attribute">MASTER_PASSWORD</span>=<span class="hljs-string">&#x27;Repl@2025&#x27;</span>,<br>  <span class="hljs-attribute">MASTER_LOG_FILE</span>=<span class="hljs-string">&#x27;主库的 binlog 文件名&#x27;</span>, <br>  <span class="hljs-attribute">MASTER_LOG_POS</span>=主库的 binlog 位置,<br>  <span class="hljs-attribute">MASTER_AUTO_POSITION</span>=1;<br><br>最新版不用位置了，如果你使用 **GTID 复制**，只需要设置 `<span class="hljs-attribute">MASTER_AUTO_POSITION</span>=1`，而不需要手动指定 `MASTER_LOG_FILE` 和 `MASTER_LOG_POS`。<br>这是因为 `<span class="hljs-attribute">MASTER_AUTO_POSITION</span>=1` 启用了 GTID（全局事务标识符）模式，GTID 模式会自动管理复制位置，而无需手动指定 `binlog` 文件和位置。<br><br>CHANGE MASTER <span class="hljs-keyword">TO</span> <br>  <span class="hljs-attribute">MASTER_HOST</span>=<span class="hljs-string">&#x27;192.168.136.8&#x27;</span>,<br>  <span class="hljs-attribute">MASTER_USER</span>=<span class="hljs-string">&#x27;repl&#x27;</span>,<br>  <span class="hljs-attribute">MASTER_PASSWORD</span>=<span class="hljs-string">&#x27;wq666666&#x27;</span>,<br>  <span class="hljs-attribute">MASTER_AUTO_POSITION</span>=1;<br><br><br><br><br>启动从库复制状态<br>START SLAVE;<br><br><br>检查从库复制状态<br>SHOW SLAVE STATUS;<br><br><br></code></pre></td></tr></table></figure>


<hr>
<h4 id="5-2-使用-Oracle-MySql-Operaotr-搭建-1-主-多从架构"><a href="#5-2-使用-Oracle-MySql-Operaotr-搭建-1-主-多从架构" class="headerlink" title="5.2. 使用 Oracle MySql Operaotr 搭建 1 主 多从架构"></a>5.2. 使用 Oracle MySql Operaotr 搭建 1 主 多从架构</h4><p>&#x3D;&#x3D;1.安装 MySQL Operator&#x3D;&#x3D;</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 1. 部署 CRDs</span><br>kubectl apply -f https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/mysql/my</span>sql-operator<span class="hljs-regexp">/trunk/</span>deploy/deploy-crds.yaml<br><br><br><span class="hljs-comment"># 2. 部署 MySQL Operator</span><br>kubectl apply -f https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/mysql/my</span>sql-operator<span class="hljs-regexp">/trunk/</span>deploy/deploy-operator.yaml<br><br><br><span class="hljs-comment"># 3. 检查 Operaotr 部署状态</span><br>kubectl get deployment -n mysql-operator mysql-operator<br></code></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] 注意事项：</p>
<ol>
<li>Oracle MySQL Operator 的 GitHub 地址：<a target="_blank" rel="noopener" href="https://github.com/mysql/mysql-operator">Oracle MySQL Operator 地址</a>，可以挑选版本或根据 README 进行安装</li>
<li>Oracle MySQL Operaotr 的安装脚本地址：<a target="_blank" rel="noopener" href="https://github.com/operator-framework/operator-lifecycle-manager/releases">Oracle MySQL Operaotr 安装脚本地址</a></li>
</ol>
</blockquote>
<hr>
<p>&#x3D;&#x3D;2.为 MySQL root 用户创建 Opaque Secret&#x3D;&#x3D;</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-meta"># 1. 对密码进行 Base64 编码</span><br>echo -n <span class="hljs-string">&quot;wq666666&quot;</span> | base64<br><br><br><br><br><span class="hljs-meta"># 2. 编写 Opaque Secret 资源 yaml </span><br><span class="hljs-symbol">apiVersion:</span> v1<br><span class="hljs-symbol">kind:</span> Secret<br><span class="hljs-symbol">metadata:</span><br><span class="hljs-symbol">  name:</span> mysql-root-secret<br><span class="hljs-symbol">  namespace:</span> mysql-operator<br><span class="hljs-symbol">type:</span> Opaque<br><span class="hljs-symbol">data:</span><br><span class="hljs-symbol">  rootPassword:</span> xxxxxxx<br><br><br><span class="hljs-meta"># 3. 创建 Opaque Secret 资源</span><br>kubectl apply -f mysql-root-secret.yaml<br></code></pre></td></tr></table></figure>





<p>3.创建 InnoDBCluster 资源</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-comment"># mysql-primary.yaml 配置文件</span><br><span class="hljs-params">apiVersion:</span> mysql.oracle.com<span class="hljs-symbol">/v2</span>            <span class="hljs-comment"># 使用 MySQL Operator 的版本，指定使用 MySQL 2.x 版本</span><br><span class="hljs-params">kind:</span> InnoDBCluster                        <span class="hljs-comment"># 类型为 InnoDBCluster，表示这是一个 MySQL InnoDB 集群</span><br><span class="hljs-params">metadata:</span><br>  <span class="hljs-params">name:</span> mysql-cluster                      <span class="hljs-comment"># MySQL 集群的名称</span><br>  <span class="hljs-params">namespace:</span> mysql-cluster   <span class="hljs-comment"># 集群所在的命名空间，确保创建在正确的命名空间下</span><br><span class="hljs-params">spec:</span><br>  <span class="hljs-params">secretName:</span> mysql-root-secret  <span class="hljs-comment"># 引用 Kubernetes 中存储 MySQL root 用户密码的 Secret</span><br>  <span class="hljs-params">instances:</span> <span class="hljs-number">3</span>  <span class="hljs-comment"># 集群中的实例数，1 主实例，2 从实例</span><br>  <span class="hljs-params">tlsUseSelfSigned:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 如果没有外部证书，则启用自签名证书（推荐用于开发和测试环境）</span><br>  <span class="hljs-params">podSpec:</span>  <span class="hljs-comment"># 为每个 Pod 定义资源和配置</span><br>    <span class="hljs-params">resources:</span><br>      <span class="hljs-params">requests:</span><br>        <span class="hljs-params">cpu:</span> <span class="hljs-string">&quot;1&quot;</span>  <span class="hljs-comment"># 每个 MySQL 实例请求的 CPU 资源</span><br>        <span class="hljs-params">memory:</span> <span class="hljs-string">&quot;2Gi&quot;</span>  <span class="hljs-comment"># 每个 MySQL 实例请求的内存资源</span><br>  <span class="hljs-params">volumeClaimTemplate:</span>  <span class="hljs-comment"># 定义存储卷的要求</span><br>    <span class="hljs-params">accessModes:</span> [<span class="hljs-string">&quot;ReadWriteOnce&quot;</span>]  <span class="hljs-comment"># 存储访问模式，表示每次只能由一个 Pod 进行读写</span><br>    <span class="hljs-params">resources:</span><br>      <span class="hljs-params">requests:</span><br>        <span class="hljs-params">storage:</span> <span class="hljs-number">50</span>Gi  <span class="hljs-comment"># 每个实例请求的存储大小（50GB）</span><br><br><br><br><br><span class="hljs-params">apiVersion:</span> mysql.oracle.com<span class="hljs-symbol">/v2</span><br><span class="hljs-params">kind:</span> InnoDBCluster<br><span class="hljs-params">metadata:</span><br>  <span class="hljs-params">name:</span> mysql-primary<br>  <span class="hljs-params">namespace:</span> mysql-cluster<br><span class="hljs-params">spec:</span><br>  <span class="hljs-params">secretName:</span> mysql-root-secret<br>  <span class="hljs-params">instances:</span> <span class="hljs-number">3</span><br>  <span class="hljs-params">tlsUseSelfSigned:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-params">podSpec:</span><br>    <span class="hljs-params">resources:</span><br>      <span class="hljs-params">requests:</span><br>        <span class="hljs-params">cpu:</span> <span class="hljs-string">&quot;1&quot;</span><br>        <span class="hljs-params">memory:</span> <span class="hljs-string">&quot;2Gi&quot;</span><br>  <span class="hljs-params">volumeClaimTemplate:</span><br>    <span class="hljs-params">accessModes:</span> [<span class="hljs-string">&quot;ReadWriteOnce&quot;</span>]<br>    <span class="hljs-params">resources:</span><br>      <span class="hljs-params">requests:</span><br>        <span class="hljs-params">storage:</span> <span class="hljs-number">50</span>Gi<br></code></pre></td></tr></table></figure>









<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-comment"># mysql-primary.yaml</span><br><br><span class="hljs-params">apiVersion:</span> mysql.oracle.com<span class="hljs-symbol">/v2</span>  <span class="hljs-comment"># 使用 MySQL Operator 的 API 版本</span><br><span class="hljs-params">kind:</span> InnoDBCluster  <span class="hljs-comment"># 资源类型为 InnoDBCluster，表示一个 MySQL 集群</span><br><span class="hljs-params">metadata:</span><br>  <span class="hljs-params">name:</span> mysql-primary  <span class="hljs-comment"># 集群名称为 mysql-primary</span><br>  <span class="hljs-params">namespace:</span> mysql-cluster  <span class="hljs-comment"># 资源所在的 Kubernetes 命名空间</span><br><span class="hljs-params">spec:</span><br>  <span class="hljs-params">secretName:</span> mysql-root-secret  <span class="hljs-comment"># 指定存储 MySQL root 密码的 Secret 名称</span><br>  <span class="hljs-params">instances:</span> <span class="hljs-number">3</span>  <span class="hljs-comment"># 设置集群中的实例数，这里有 1 个主节点和 2 个从节点</span><br>  <span class="hljs-params">tlsUseSelfSigned:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 如果没有外部证书，则启用自签名证书进行 TLS 加密通信</span><br>  <span class="hljs-params">podSpec:</span><br>    <span class="hljs-params">resources:</span><br>      <span class="hljs-params">requests:</span><br>        <span class="hljs-params">cpu:</span> <span class="hljs-string">&quot;1&quot;</span>  <span class="hljs-comment"># 请求的 CPU 资源为 1 核</span><br>        <span class="hljs-params">memory:</span> <span class="hljs-string">&quot;2Gi&quot;</span>  <span class="hljs-comment"># 请求的内存资源为 2Gi</span><br>  <span class="hljs-params">volumeClaimTemplate:</span><br>    <span class="hljs-params">accessModes:</span> [<span class="hljs-string">&quot;ReadWriteOnce&quot;</span>]  <span class="hljs-comment"># 存储访问模式，表示每个节点只能有一个读写访问</span><br>    <span class="hljs-params">resources:</span><br>      <span class="hljs-params">requests:</span><br>        <span class="hljs-params">storage:</span> <span class="hljs-number">50</span>Gi  <span class="hljs-comment"># 每个 MySQL 实例请求 50Gi 的存储空间</span><br><br><br><br><br><span class="hljs-comment"># mysql-primary.yaml</span><br><br><span class="hljs-params">apiVersion:</span> mysql.oracle.com<span class="hljs-symbol">/v2</span><br><span class="hljs-params">kind:</span> InnoDBCluster<br><span class="hljs-params">metadata:</span><br>  <span class="hljs-params">name:</span> mysql-primary<br>  <span class="hljs-params">namespace:</span> mysql-cluster<br><span class="hljs-params">spec:</span><br>  <span class="hljs-params">secretName:</span> mysql-root-secret<br>  <span class="hljs-params">instances:</span> <span class="hljs-number">3</span><br>  <span class="hljs-params">tlsUseSelfSigned:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-params">podSpec:</span><br>    <span class="hljs-params">resources:</span><br>      <span class="hljs-params">requests:</span><br>        <span class="hljs-params">cpu:</span> <span class="hljs-string">&quot;1&quot;</span><br>        <span class="hljs-params">memory:</span> <span class="hljs-string">&quot;2Gi&quot;</span><br>  <span class="hljs-params">volumeClaimTemplate:</span><br>    <span class="hljs-params">accessModes:</span> [<span class="hljs-string">&quot;ReadWriteOnce&quot;</span>]<br>    <span class="hljs-params">resources:</span><br>      <span class="hljs-params">requests:</span><br>        <span class="hljs-params">storage:</span> <span class="hljs-number">50</span>Gi<br><br></code></pre></td></tr></table></figure>




























<h3 id="数据表设计"><a href="#数据表设计" class="headerlink" title="数据表设计"></a>数据表设计</h3><p>以下是为文学网站设计的数据库表结构，基于需求分析和实体-属性图，包含五个核心数据表：Users（用户表）、Categories（版块表）、Moderators（版主授权表）、Articles（文章表）和 Comments（留言表）。每张表按照用户查询中提供的格式，列出 <strong>序号</strong>、<strong>数据项名称</strong>、<strong>数据类型</strong>、<strong>范围约束</strong>、<strong>关键数据项</strong> 和 <strong>含义</strong>，以确保数据一致性、完整性和高效查询。</p>
<hr>
<h4 id="1-Users（用户表）"><a href="#1-Users（用户表）" class="headerlink" title="1. Users（用户表）"></a>1. Users（用户表）</h4><p><strong>描述</strong>：存储用户信息，用于身份验证和权限管理。</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>数据项名称</th>
<th>数据类型</th>
<th>范围约束</th>
<th>关键数据项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>UserID</td>
<td>INT</td>
<td>无</td>
<td>是</td>
<td>用户表主键，自增</td>
</tr>
<tr>
<td>2</td>
<td>Username</td>
<td>VARCHAR(50)</td>
<td>非空，唯一</td>
<td>是</td>
<td>用户名，用于登录</td>
</tr>
<tr>
<td>3</td>
<td>Password</td>
<td>VARCHAR(255)</td>
<td>非空</td>
<td>否</td>
<td>用户密码（加密存储）</td>
</tr>
<tr>
<td>4</td>
<td>Email</td>
<td>VARCHAR(100)</td>
<td>非空，唯一</td>
<td>是</td>
<td>用户邮箱，用于联系</td>
</tr>
<tr>
<td>5</td>
<td>Role</td>
<td>ENUM</td>
<td>‘Member’, ‘Moderator’, ‘Admin’</td>
<td>否</td>
<td>用户角色</td>
</tr>
<tr>
<td>6</td>
<td>CreatedAt</td>
<td>TIMESTAMP</td>
<td>无</td>
<td>否</td>
<td>用户注册时间</td>
</tr>
<tr>
<td>7</td>
<td>UpdatedAt</td>
<td>TIMESTAMP</td>
<td>无</td>
<td>否</td>
<td>用户信息更新时间</td>
</tr>
</tbody></table>
<hr>
<h4 id="2-Categories（版块表）"><a href="#2-Categories（版块表）" class="headerlink" title="2. Categories（版块表）"></a>2. Categories（版块表）</h4><p><strong>描述</strong>：存储文章分类版块信息，如“茶余饭后”“风花雪月”。</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>数据项名称</th>
<th>数据类型</th>
<th>范围约束</th>
<th>关键数据项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>CategoryID</td>
<td>INT</td>
<td>无</td>
<td>是</td>
<td>版块表主键，自增</td>
</tr>
<tr>
<td>2</td>
<td>CategoryName</td>
<td>VARCHAR(50)</td>
<td>非空，唯一</td>
<td>是</td>
<td>版块名称</td>
</tr>
<tr>
<td>3</td>
<td>Description</td>
<td>TEXT</td>
<td>可为空</td>
<td>否</td>
<td>版块描述</td>
</tr>
<tr>
<td>4</td>
<td>CreatedAt</td>
<td>TIMESTAMP</td>
<td>无</td>
<td>否</td>
<td>版块创建时间</td>
</tr>
</tbody></table>
<hr>
<h4 id="3-Moderators（版主授权表）"><a href="#3-Moderators（版主授权表）" class="headerlink" title="3. Moderators（版主授权表）"></a>3. Moderators（版主授权表）</h4><p><strong>描述</strong>：记录版主对特定版块的管理权限。</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>数据项名称</th>
<th>数据类型</th>
<th>范围约束</th>
<th>关键数据项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>ModeratorID</td>
<td>INT</td>
<td>无</td>
<td>是</td>
<td>版主授权表主键，自增</td>
</tr>
<tr>
<td>2</td>
<td>UserID</td>
<td>INT</td>
<td>无</td>
<td>是</td>
<td>版主用户ID（外键，引用 Users.UserID）</td>
</tr>
<tr>
<td>3</td>
<td>CategoryID</td>
<td>INT</td>
<td>无</td>
<td>是</td>
<td>管理的版块ID（外键，引用 Categories.CategoryID）</td>
</tr>
<tr>
<td>4</td>
<td>AssignedAt</td>
<td>TIMESTAMP</td>
<td>无</td>
<td>否</td>
<td>授权时间</td>
</tr>
</tbody></table>
<hr>
<h4 id="4-Articles（文章表）"><a href="#4-Articles（文章表）" class="headerlink" title="4. Articles（文章表）"></a>4. Articles（文章表）</h4><p><strong>描述</strong>：存储用户发表的文章信息，包括标题、内容和状态。</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>数据项名称</th>
<th>数据类型</th>
<th>范围约束</th>
<th>关键数据项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>ArticleID</td>
<td>INT</td>
<td>无</td>
<td>是</td>
<td>文章表主键，自增</td>
</tr>
<tr>
<td>2</td>
<td>UserID</td>
<td>INT</td>
<td>无</td>
<td>是</td>
<td>作者用户ID（外键，引用 Users.UserID）</td>
</tr>
<tr>
<td>3</td>
<td>CategoryID</td>
<td>INT</td>
<td>无</td>
<td>是</td>
<td>所属版块ID（外键，引用 Categories.CategoryID）</td>
</tr>
<tr>
<td>4</td>
<td>Title</td>
<td>VARCHAR(200)</td>
<td>非空</td>
<td>否</td>
<td>文章标题</td>
</tr>
<tr>
<td>5</td>
<td>Content</td>
<td>TEXT</td>
<td>非空</td>
<td>否</td>
<td>文章内容</td>
</tr>
<tr>
<td>6</td>
<td>Status</td>
<td>ENUM</td>
<td>‘Draft’, ‘Pending’, ‘Published’, ‘Deleted’</td>
<td>否</td>
<td>文章状态</td>
</tr>
<tr>
<td>7</td>
<td>CreatedAt</td>
<td>TIMESTAMP</td>
<td>无</td>
<td>否</td>
<td>文章创建时间</td>
</tr>
<tr>
<td>8</td>
<td>UpdatedAt</td>
<td>TIMESTAMP</td>
<td>无</td>
<td>否</td>
<td>文章更新时间</td>
</tr>
</tbody></table>
<hr>
<h4 id="5-Comments（留言表）"><a href="#5-Comments（留言表）" class="headerlink" title="5. Comments（留言表）"></a>5. Comments（留言表）</h4><p><strong>描述</strong>：存储游客和会员对文章的留言。</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>数据项名称</th>
<th>数据类型</th>
<th>范围约束</th>
<th>关键数据项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>CommentID</td>
<td>INT</td>
<td>无</td>
<td>是</td>
<td>留言表主键，自增</td>
</tr>
<tr>
<td>2</td>
<td>ArticleID</td>
<td>INT</td>
<td>无</td>
<td>是</td>
<td>关联文章ID（外键，引用 Articles.ArticleID）</td>
</tr>
<tr>
<td>3</td>
<td>UserID</td>
<td>INT</td>
<td>可为空</td>
<td>否</td>
<td>留言用户ID（外键，引用 Users.UserID）</td>
</tr>
<tr>
<td>4</td>
<td>GuestEmail</td>
<td>VARCHAR(100)</td>
<td>可为空</td>
<td>否</td>
<td>游客邮箱</td>
</tr>
<tr>
<td>5</td>
<td>Content</td>
<td>TEXT</td>
<td>非空</td>
<td>否</td>
<td>留言内容</td>
</tr>
<tr>
<td>6</td>
<td>CreatedAt</td>
<td>TIMESTAMP</td>
<td>无</td>
<td>否</td>
<td>留言时间</td>
</tr>
</tbody></table>
<hr>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ul>
<li><strong>关键数据项</strong>：标记为“是”的字段是主键或外键，用于唯一标识记录或关联其他表。</li>
<li><strong>范围约束</strong>：<ul>
<li><strong>非空</strong>：该字段不能为空。</li>
<li><strong>唯一</strong>：该字段值在表中必须唯一。</li>
<li><strong>可为空</strong>：该字段可以为空，如 Comments 表中的 UserID 和 GuestEmail。</li>
</ul>
</li>
<li><strong>数据类型</strong>：<ul>
<li><strong>INT</strong>：整数类型，用于ID字段。</li>
<li>**VARCHAR(n)**：变长字符串，n 为最大长度。</li>
<li><strong>TEXT</strong>：长文本类型，用于文章和留言内容。</li>
<li><strong>ENUM</strong>：枚举类型，限制取值范围，如 Role 和 Status。</li>
<li><strong>TIMESTAMP</strong>：时间戳，记录创建和更新时间。</li>
</ul>
</li>
<li><strong>外键关系</strong>：<ul>
<li>Moderators.UserID 引用 Users.UserID</li>
<li>Moderators.CategoryID 引用 Categories.CategoryID</li>
<li>Articles.UserID 引用 Users.UserID</li>
<li>Articles.CategoryID 引用 Categories.CategoryID</li>
<li>Comments.ArticleID 引用 Articles.ArticleID</li>
<li>Comments.UserID 引用 Users.UserID（可为空）</li>
</ul>
</li>
<li><strong>其他约束</strong>：Comments 表中 UserID 和 GuestEmail 至少一个不为空，以支持游客和会员留言。</li>
</ul>
<hr>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>以上数据表设计满足文学网站的核心需求，包括用户管理、版块分类、版主授权、文章发布和留言功能。设计中充分考虑了字段类型、约束和外键关系，确保数据的一致性、完整性和查询效率。</p>
<h3 id="1-导图：Map：数据类型和传参"><a href="#1-导图：Map：数据类型和传参" class="headerlink" title="1. 导图：Map：数据类型和传参"></a>1. 导图：<a href="Map%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E4%BC%A0%E5%8F%82.xmind">Map：数据类型和传参</a></h3><hr>
<h3 id="2-ES-数据类型"><a href="#2-ES-数据类型" class="headerlink" title="2. ES 数据类型"></a>2. ES 数据类型</h3><table>
<thead>
<tr>
<th><strong>名称</strong></th>
<th><strong>范围</strong></th>
<th><strong>描述</strong></th>
<th><strong>赋值示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>数值类型</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>byte</code></td>
<td>1字节，-128 ~ 127</td>
<td>小范围整数</td>
<td><code>&quot;age&quot;: 20</code></td>
</tr>
<tr>
<td><code>short</code></td>
<td>2 字节，-32768 ~ 32767</td>
<td>稍大范围整数</td>
<td><code>&quot;small_order_count&quot;: 300</code></td>
</tr>
<tr>
<td><code>integer</code></td>
<td>4 字节，-2^31 ~ 2^31 -1</td>
<td>常规整数</td>
<td><code>&quot;sales_volume&quot;: 1234567890123</code></td>
</tr>
<tr>
<td><code>long</code></td>
<td>8 字节，-2^63 ~ 2^63 -1</td>
<td>非常大的整数</td>
<td><code>&quot;sales_volume&quot;: 1234567890123</code></td>
</tr>
<tr>
<td><code>half_float</code></td>
<td>2 字节，3 ~ 5 位十进制精度</td>
<td>半精度浮点数牺牲精度，节省空间</td>
<td><code>&quot;sensor_data&quot;: 12.3</code></td>
</tr>
<tr>
<td><code>float</code></td>
<td>4 字节，7 位十进制精度</td>
<td>常规浮点数，精度较低</td>
<td><code>&quot;rating&quot;: 4.5</code></td>
</tr>
<tr>
<td><code>double</code></td>
<td>8 字节，15 ~ 16 位十进制精度</td>
<td>双精度浮点数，高精度，适合科学计算</td>
<td><code>&quot;measurement_value&quot;: 0.000000123</code></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>字符串类型</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>keyword</code></td>
<td></td>
<td>精确值</td>
<td><code>&quot;status&quot;: &quot;published&quot;</code></td>
</tr>
<tr>
<td><code>text</code></td>
<td></td>
<td>可分词文本</td>
<td><code>&quot;title&quot;: &quot;Elasticsearch Guide&quot;</code></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>布尔类型</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>boolean</code></td>
<td>1字节，true、false</td>
<td></td>
<td><code>&quot;is_online&quot;: true</code></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>日期与时间类型</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>date</code></td>
<td>支持从 1970-01-01T00:00:00Z 起的正负时间戳，实际范围取决于具体日期解析格式等</td>
<td>存储日期时间信息</td>
<td><code>&quot;created_time&quot;: &quot;2025-04-04T10:30:00Z&quot;</code>（标准格式赋值）</td>
</tr>
<tr>
<td><code>date_nanos</code></td>
<td>可存储到纳秒级别精度的日期时间，范围从 1970-01-01T00:00:00Z 起的正负纳秒时间戳</td>
<td>对时间精度要求极高的场景，如金融交易的精确时间戳、高精度实验数据的时间记录等</td>
<td><code>&quot;trade_time&quot;: &quot;2025-04-04T10:30:00.123456789Z&quot;</code>（标准格式赋值）</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>地理空间类型</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>geo_point</code></td>
<td>经度范围 -180.0 ~ 180.0，纬度范围 -90.0 ~ 90.0</td>
<td>存储由经度和纬度确定的地理坐标点</td>
<td><code>&quot;location&quot;: &#123; 39.9042, 116.4074 &#125;</code><br>（39.9042 是纬度，116.4074 是经度）</td>
</tr>
<tr>
<td><code>geo_shape</code></td>
<td></td>
<td>存储由多个 <code>geo_point</code> 组成的复杂的地理形状数据，如点、线、面、多边形等</td>
<td><strong>点</strong>：<code>&quot;area_shape&quot;: &#123; &quot;type&quot;: &quot;point&quot;, &quot;coordinates&quot;: [40.73, -73.93] &#125;</code><br><strong>矩形</strong>：<code>&quot;area_shape&quot;: &#123; &quot;type&quot;: &quot;envelope&quot;,&quot;coordinates&quot;: [[-74, 40], [-73, 41]] &#125;</code><br><strong>圆形</strong>：<code>&quot;area_shape&quot;: &#123; &quot;type&quot;: &quot;circle&quot;, &quot;coordinates&quot;: [100.0, 0.0],   &quot;radius&quot;: &quot;100m“ &#125;</code><br><strong>任意形状</strong>：<code>&quot;area_shape&quot;: &#123; &quot;type&quot;: &quot;polygon&quot;, &quot;coordinates&quot;: [[ [100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0], [100.0, 0.0] ]] &#125;</code></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>复杂类型</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>object</code></td>
<td></td>
<td>用于在文档中嵌套其他文档，将相关字段组织在一起，如存储用户的详细信息（姓名、年龄、地址等在一个对象中）</td>
<td><code>&quot;user_info&quot;: &#123; &quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 30, &quot;address&quot;: &quot;New York&quot; &#125;</code></td>
</tr>
<tr>
<td><code>nested</code></td>
<td></td>
<td>与 <code>object</code> 类似，用于嵌套数组对象，使数组中的每个对象都能被独立地查询和聚合，如存储一篇博客的多条评论，每个评论又包含评论者信息、评论内容等</td>
<td><code>&quot;comments&quot;: [ &#123; &quot;user&quot;: &quot;Alice&quot;, &quot;content&quot;: &quot;Great post!&quot; &#125;, &#123; &quot;user&quot;: &quot;Bob&quot;, &quot;content&quot;: &quot;Very helpful.&quot; &#125; ]</code></td>
</tr>
</tbody></table>
<hr>
<h3 id="3-MySQL-数据类型"><a href="#3-MySQL-数据类型" class="headerlink" title="3. MySQL 数据类型"></a>3. MySQL 数据类型</h3><table>
<thead>
<tr>
<th>名称</th>
<th>范围</th>
<th>描述</th>
<th>赋值示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>数值类型</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>TINYINT</code></td>
<td>1 字节，-128 ~ 127</td>
<td>小范围整数</td>
<td><code>INSERT INTO table (tinyint_column) VALUES (20);</code></td>
</tr>
<tr>
<td><code>SMALLINT</code></td>
<td>2 字节，-32768 ~ 32767</td>
<td>稍大范围整数</td>
<td><code>INSERT INTO table (smallint_column) VALUES (300);</code></td>
</tr>
<tr>
<td><code>MEDIUMINT</code></td>
<td>3 字节，-8,388,608 ~ 8,388,607</td>
<td>中等范围整数</td>
<td><code>INSERT INTO table (mediumint_column) VALUES (500000);</code></td>
</tr>
<tr>
<td><code>INT</code></td>
<td>4 字节，-2^31 ~ 2^31 - 1（21 亿）</td>
<td>常规整数</td>
<td><code>INSERT INTO table (int_column) VALUES (1000000);</code></td>
</tr>
<tr>
<td><code>BIGINT</code></td>
<td>8 字节，-2^63 ~ 2^63 - 1</td>
<td>非常大的整数</td>
<td><code>INSERT INTO table (bigint_column) VALUES (9223372036854775807);</code></td>
</tr>
<tr>
<td><code>FLOAT</code></td>
<td>4 字节，7 位十进制精度</td>
<td>常规浮点数，单精度，精度较低</td>
<td><code>INSERT INTO table (float_column) VALUES (4.5);</code></td>
</tr>
<tr>
<td><code>DOUBLE</code></td>
<td>8 字节，15 ~ 16 位十进制精度</td>
<td>双精度浮点数，精度高，适合科学计算</td>
<td><code>INSERT INTO table (double_column) VALUES (0.000000123);</code></td>
</tr>
<tr>
<td><code>DECIMAL</code></td>
<td>精度可调，最大精度 65</td>
<td>精确小数，不丢失精度，适合金额等精度要求</td>
<td><code>INSERT INTO table (decimal_column) VALUES (1234567890.12);</code></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>字符串类型</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>CHAR(n)</code></td>
<td>0 ~ 255 字符</td>
<td>定长字符串，无论实际存储多少内容，始终占用 <code>n</code> 个字符的空间（不足部分用空格填充）。</td>
<td><code>INSERT INTO table (char_column) VALUES (&#39;abc&#39;);</code></td>
</tr>
<tr>
<td><code>VARCHAR(n)</code></td>
<td>0 ~ 65535 字符</td>
<td>变长字符串，根据实际内容动态分配空间，<code>n</code> 表示可存储的最大字符数，不会浪费空间。</td>
<td><code>INSERT INTO table (varchar_column) VALUES (&#39;Elasticsearch Guide&#39;);</code></td>
</tr>
<tr>
<td><code>TINYTEXT</code></td>
<td>最大 255 字符</td>
<td>变长字符串，用于存储短文本</td>
<td><code>INSERT INTO table (tinytext_column) VALUES (&#39;Hello&#39;);</code></td>
</tr>
<tr>
<td><code>TEXT</code></td>
<td>最大 65,535 字符（64KB）</td>
<td>变长字符串，用于存储较长文本</td>
<td><code>INSERT INTO table (text_column) VALUES (&#39;This is a long text...&#39;);</code></td>
</tr>
<tr>
<td><code>MEDIUMTEXT</code></td>
<td>最大 16,777,215 字符（16MB）</td>
<td>变长字符串，用于存储更长文本</td>
<td><code>INSERT INTO table (mediumtext_column) VALUES (&#39;Very long...&#39;);</code></td>
</tr>
<tr>
<td><code>LONGTEXT</code></td>
<td>最大 4,294,967,295 字符（4GB）</td>
<td>变长字符串，用于存储极长文本</td>
<td><code>INSERT INTO table (longtext_column) VALUES (&#39;Extremely long...&#39;);</code></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>日期与时间类型</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>DATE</code></td>
<td>1000-01-01 ~ 9999-12-31</td>
<td>仅日期</td>
<td><code>INSERT INTO table (date_column) VALUES (&#39;2000-01-01&#39;);</code></td>
</tr>
<tr>
<td><code>TIME</code></td>
<td>-838:59:59 ~ 838:59:59</td>
<td>仅时间</td>
<td><code>INSERT INTO table (time_column) VALUES (&#39;14:30:00&#39;);</code></td>
</tr>
<tr>
<td><code>DATETIME</code></td>
<td>1000-01-01 00:00:00 ~ 9999-12-31 23:59:59</td>
<td>日期 + 时间</td>
<td><code>INSERT INTO table (datetime_column) VALUES (&#39;2025-04-04 10:30:00&#39;);</code></td>
</tr>
<tr>
<td><code>YEAR</code></td>
<td>1901 ~ 2155</td>
<td>仅年份</td>
<td><code>INSERT INTO table (year_column) VALUES (2000);</code></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
<td>1970-01-01 00:00:01 ~ 2038-01-19 03:14:07 UTC</td>
<td>自动记录当前时间戳（非 Unix 中的时间戳，而是：YYYY-MM-DD HH:MM:SS）</td>
<td><code>INSERT INTO table (timestamp_column) VALUES (CURRENT_TIMESTAMP);</code></td>
</tr>
</tbody></table>
<hr>
<h3 id="Redis-数据类型"><a href="#Redis-数据类型" class="headerlink" title="Redis 数据类型"></a>Redis 数据类型</h3>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/" class="category-chain-item">数据管理</a>
  
  
    <span>></span>
    
  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/" class="category-chain-item">关系型数据库</a>
  
  
    <span>></span>
    
  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/" class="category-chain-item">MySQL</a>
  
  
    <span>></span>
    
  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL-%E5%9F%BA%E7%A1%80/" class="category-chain-item">MySQL 基础</a>
  
  

  

  

  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>笔记：MySQL 基础</div>
      <div>https://wangjia5289.github.io/2025/04/06/笔记：MySQL 基础/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>霸天</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>April 6, 2025</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/04/08/%E7%AC%94%E8%AE%B0%EF%BC%9ACeph%20%E5%9F%BA%E7%A1%80/" title="笔记：Ceph 基础">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">笔记：Ceph 基础</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/04/05/%E7%AC%94%E8%AE%B0%EF%BC%9AMIME%20%E7%B1%BB%E5%9E%8B/" title="笔记：MIME 类型">
                        <span class="hidden-mobile">笔记：MIME 类型</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  



  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  var relativeDate = function() {
    var updatedTime = document.getElementById('updated-time');
    if (updatedTime) {
      var text = updatedTime.textContent;
      var reg = /\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|[+-]\d{2}:\d{2})/;
      var matchs = text.match(reg);
      if (matchs) {
        var relativeTime = moment(matchs[0]).fromNow();
        updatedTime.textContent = text.replace(reg, relativeTime);
      }
      updatedTime.style.display = '';
    }
  };
  Fluid.utils.createScript('https://lib.baomitu.com/moment.js/2.29.4/moment.min.js', function() {
    if (!'en'.startsWith('en')) {
      Fluid.utils.createScript('https://lib.baomitu.com/moment.js/2.29.4/locale/en.min.js', function() {
        relativeDate();
      });
    } else {
      relativeDate();
    }
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"display":{"superSample":2,"width":200,"height":350,"position":"left","hOffset":40,"vOffset":-20},"mobile":{"show":false,"scale":0.5},"react":{"opacityDefault":1,"opacityOnHover":0.5},"log":false});</script></body>
</html>
